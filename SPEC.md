# COSMIC CHEMISTRY: DECK - 仕様書

**バージョン**: 1.0
**最終更新**: 2025-12-09
**プロジェクト開始**: 2025-12-09
**初期リリース目標**: 2026-01-09（1ヶ月後）

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [技術スタック](#技術スタック)
3. [ゲームシステム](#ゲームシステム)
4. [カードシステム](#カードシステム)
5. [バトルシステム](#バトルシステム)
6. [クイズシステム](#クイズシステム)
7. [進行・ランクシステム](#進行ランクシステム)
8. [UI/UX設計](#uiux設計)
9. [データ構造](#データ構造)
10. [リリース計画](#リリース計画)
11. [将来的な拡張](#将来的な拡張)

---

## プロジェクト概要

### コンセプト
高校化学の学習とカードゲームを融合させた教育型エンターテイメントアプリケーション。化学知識を楽しく身につけながら、戦略的なカードバトルを楽しめる。

### 目的
- **主目的**: 化学学習とゲームの両立
- **ターゲット**: 高校生（化学中級者レベル）
- **プレイ時間**: 1バトル5分程度（クイズ含む）

### 基本方針
- 現在の`index.html`のカードゲーム路線を基盤に開発
- 教育とエンターテイメントのバランスを重視
- 非営利プロジェクト（将来的なマネタイズ可能性は保留）

---

## 技術スタック

### フロントエンド
- **HTML5** / **CSS3** / **JavaScript (ES6+)**
- TypeScript移行は任意（優先度: 低）
- ビルドツール: なし（シンプルな構成を維持）
- ファイル構成: HTML/CSS/JSを分割

### バックエンド・インフラ
- **Firebase Authentication** (Google Sign-in)
- **Cloud Firestore** (ユーザーデータ永続化)
- **Firebase Hosting** (デプロイ)

### アセット
- **カードビジュアル**: 3Dモデル（アセット使用、優先度: 中）
- **サウンド/BGM**: フリー素材（ポップ調）
- **効果音**: レアリティごとに変更

### 対応環境
- **レスポンシブデザイン**: PC/モバイル両対応
- **アクセシビリティ**: 考慮なし（初期リリース）
- **オフライン対応**: オンライン復帰時に同期

---

## ゲームシステム

### コアループ
```
1. ホーム画面
   ↓
2. エリア選択
   ↓
3. バトル開始
   ↓
4. クイズ（マナチャージ）
   ↓
5. カードプレイ
   ↓
6. 敵ターン
   ↓
7. 勝敗判定
   ↓
8. 報酬獲得（エネルギー、カード、ランクポイント）
   ↓
9. ホームに戻る
```

### プレイヤー進行
- **初期カード**: 5枚
- **初期エネルギー**: 500
- **初期ランク**: F

### エネルギーシステム
- **用途**: ガチャ（カード獲得）
- **獲得方法**:
  - バトル勝利: +200
  - アチーブメント: 10個達成でガチャ1回分（100エネルギー）
  - デイリーログイン（将来的）
- **消費**:
  - 通常ガチャ: 100
  - 上位ガチャ: 100（ランク解放が必要）

---

## カードシステム

### カードタイプ
| タイプ | 説明 | 例 |
|--------|------|-----|
| **ACID** | 酸性物質 | 塩酸、硫酸、硝酸、王水 |
| **BASE** | 塩基性物質 | 水酸化Na、アンモニア、水酸化Ca |
| **METAL** | 金属元素 | 鉄、亜鉛、銅 |
| **NEUTRAL** | 中性物質 | 水、過酸化水素、触媒、塩化Na、オゾン |
| **ORGANIC** | 有機化合物 | アルコール、アルデヒド、カルボン酸 *(拡張予定)* |
| **ION** | イオン | Na⁺、Cl⁻、SO₄²⁻ *(拡張予定)* |
| **CATALYST** | 触媒 | 酸化バナジウム(V)、白金 *(拡張予定)* |

### レアリティ
| レアリティ | 排出率 | 特徴 |
|-----------|--------|------|
| **COMMON** | 60% | 基本カード |
| **RARE** | 25% | コンボ持ち |
| **EPIC** | 12% | 強力な効果 |
| **LEGENDARY** | 3% | 最強カード |

### カード構成
```javascript
{
  id: Number,           // カードID
  name: String,         // カード名（例: "塩酸"）
  type: String,         // カードタイプ
  val: Number,          // 基礎値（ダメージ/回復量など）
  cost: Number,         // マナコスト
  img: String,          // 画像/化学式
  rarity: String,       // レアリティ
  effectType: String,   // 効果タイプ（damage/heal/draw/manaBoost/special）
  target: String,       // 対象（enemy/self）
  combo: Object,        // コンボ条件
  comboBonus: Object,   // コンボボーナス
  description: String,  // カード説明
  level: Number,        // 強化レベル (1-10)
  chemInfo: String      // 化学解説（例: "HClの水溶液。pKa=-7の強酸。胃酸の主成分。"）
}
```

### カード目標数
- **初期リリース**: 30枚
- **最終目標**: 100枚以上

### カード強化システム
- **最大レベル**: Lv.10
- **強化効果**: ダメージ値 +5%/レベル
- **強化素材**:
  - 同じカード×2枚
  - コイン（エネルギーとは別の通貨）×100
- **例**: Lv.1 塩酸（30ダメージ） → Lv.10（45ダメージ）

### コンボシステム

#### シンプルコンボ（現行）
- フィールド履歴の最新5枚を参照
- 条件: 特定タイプが指定枚数以上
- 例: 硫酸（ACID 1枚でコンボ） → ダメージ+15

#### 複雑コンボ（拡張）
- **複合タイプコンボ**: `ACID + METAL → 水素ガス発生（追加ドロー）`
- **連鎖コンボ**: `BASE → ACID → NEUTRAL（中和反応） → HP回復+30`
- **3種コンボ**: `ACID + BASE + METAL → 超強化バフ`

---

## バトルシステム

### バトルフロー（1バトル: 約10ターン、5分想定）

```
【プレイヤーターン】
1. クイズ出題（30秒制限時間）
2. 正解 → マナ+3 / 不正解 → マナ+1
3. カードドロー（1枚）
4. 手札からカードをプレイ（マナ消費）
5. エフェクト解決（ダメージ、バフ、ドロー等）
   ↓
【敵ターン】
6. 敵がランダムにカードを使用
7. エフェクト解決
   ↓
【勝敗判定】
8. 敵HP 0 → 勝利
9. プレイヤーHP 0 → 敗北
10. 継続 → プレイヤーターンへ
```

### 初期設定
- **プレイヤーHP**: 200
- **敵HP**: エリアごとに変動（150〜300）
- **初期手札**: 3枚
- **デッキ枚数**: 20枚（固定）
- **手札上限**: 5枚
- **マナ上限**: 10

### デッキ構築
- **デッキスロット数**: 5個
- **同名カード制限**: 2枚まで
- **コスト制限**: なし
- **編集方法**: ドラッグ&ドロップ

### 制限時間
- **クイズ回答**: 30秒/問
- **カード選択**: 制限なし（将来的に60秒等設定可能）

### バフ/デバフシステム
| バフ名 | 効果 | 持続 |
|--------|------|------|
| **Shield** | 次のダメージ-10 | 1ターン |
| **DamageBoost** | 次の攻撃+15 | 1ターン |
| **Poison** | ターン終了時5ダメージ | 3ターン *(拡張)* |
| **Regeneration** | ターン開始時10回復 | 3ターン *(拡張)* |

---

## クイズシステム

### クイズデータベース
- **問題数**: 100問以上
- **カテゴリ**: 高校化学の無機化学（暗記系）
- **形式**: 4択問題のみ

### 難易度設定
| 難易度 | 内容 | 配分 |
|--------|------|------|
| **普通** | 基礎的な暗記問題 | 60% |
| **難** | 応用・発展的な問題 | 40% |

- **難易度切り替え**: プレイヤーの進行度に応じて自動調整
- **調整ロジック**: ランクF-D → 普通のみ、ランクC以上 → 難問も混在

### 問題例

#### 普通レベル
```javascript
{
  q: "原子番号1番の元素は？",
  options: ["He", "H", "Li", "Be"],
  ans: 1, // H
  category: "元素",
  difficulty: "normal"
}
```

#### 難レベル
```javascript
{
  q: "接触法で硫酸を製造する際の触媒は？",
  options: ["酸化バナジウム(V)", "白金", "鉄", "銅"],
  ans: 0,
  category: "工業化学",
  difficulty: "hard"
}
```

### マナ獲得
- **正解**: +3マナ
- **不正解**: +1マナ（救済措置）

---

## 進行・ランクシステム

### エリア（ステージ）構成

高校化学の分野ごとに12エリア

| # | エリア名 | テーマ | ボス | 解放条件 |
|---|---------|--------|------|---------|
| 1 | **物質の構成** | 原子、イオン、同位体 | "イオン王" | 初期解放 |
| 2 | **化学結合** | イオン結合、共有結合、金属結合 | "結合の守護者" | ランクE |
| 3 | **物質の状態** | 気体、液体、固体、状態変化 | "相変化の魔術師" | ランクE |
| 4 | **化学反応** | 化学反応式、量的関係 | "反応式マスター" | ランクD |
| 5 | **酸と塩基** | pH、中和反応、塩 | "酸性雨の悪魔" | ランクD |
| 6 | **酸化還元** | 酸化数、酸化剤、還元剤 | "電子の支配者" | ランクC |
| 7 | **電池・電気分解** | ボルタ電池、電気分解 | "電流の番人" | ランクC |
| 8 | **無機化学(非金属)** | ハロゲン、硫黄、窒素 | "塩素ガスの暴君" | ランクB |
| 9 | **無機化学(金属)** | アルカリ金属、遷移元素 | "鉄の巨人" | ランクB |
| 10 | **有機化学(脂肪族)** | アルカン、アルコール、カルボン酸 | "アルコール王" | ランクA |
| 11 | **有機化学(芳香族)** | ベンゼン、フェノール、アニリン | "ベンゼン環の覇者" | ランクA |
| 12 | **高分子化合物** | 合成高分子、天然高分子 | "ポリマーの帝王" | ランクS |

### ボスの特徴
- **固有能力**: エリアごとに特殊なギミック
  - 例: エリア5のボス → 酸カードのダメージ+20%
  - 例: エリア8のボス → ターン開始時にプレイヤーに毒効果
- **デザイン**: 元素/化合物を擬人化したモンスター

### ランクシステム
| ランク | 必要勝利数 | 特典 |
|--------|-----------|------|
| **F** | 初期 | 通常ガチャのみ |
| **E** | 5勝 | エリア2-3解放 |
| **D** | 15勝 | エリア4-5解放、レアガチャ解放 |
| **C** | 30勝 | エリア6-7解放 |
| **B** | 50勝 | エリア8-9解放、エピックガチャ解放 |
| **A** | 80勝 | エリア10-11解放 |
| **S** | 120勝 | エリア12解放、レジェンドガチャ解放 |

- **ランクアップ**: 累計勝利数のみで判定
- **ランク降格**: なし

### アチーブメントシステム

#### 種類
| カテゴリ | 例 |
|---------|-----|
| **使用系** | 「塩酸を10回使用」「ACIDカードで累計1000ダメージ」 |
| **戦績系** | 「5連勝達成」「ノーダメージ勝利」「10ターン以内にクリア」 |
| **収集系** | 「カード30種類収集」「レジェンドカード1枚獲得」 |
| **コンボ系** | 「コンボを50回発動」「3種類コンボ達成」 |
| **クイズ系** | 「クイズ100問正解」「難問を10問連続正解」 |

#### 報酬
- **エネルギー**: 10アチーブメントごとにガチャ1回分（100エネルギー）
- **限定カード**: 特定アチーブメント（例: 全カード収集）で入手可能
- **称号**: プロフィールに表示可能（将来的）

### ストーリーモード
- **主人公設定**: 化学を学ぶ高校生
- **ストーリー展開**:
  - 各エリアクリア前: 導入テキスト（200字程度）
  - 各エリアクリア後: 結果テキスト + 次エリア予告
- **エンディング**: エリア12クリアでエンディング（単一）
- **テーマ**: 問題が難しくなるにつれ成長していくストーリー

---

## UI/UX設計

### デザインコンセプト
- **スタイル**: サイバーパンク/SF風（現行デザイン維持）
- **カラーパレット**:
  - シアン: `#00f3ff`
  - ブルー: `#0066ff`
  - ピンク: `#ff0055`
  - ゴールド: `#ffd700`
  - 背景: `#050b14`

### 画面構成

#### 1. ログイン画面
```
┌─────────────────────────────┐
│   COSMIC CHEMISTRY: DECK    │
│                             │
│   [Sign in with Google]     │
└─────────────────────────────┘
```

#### 2. ホーム画面
```
┌─────────────────────────────┐
│ プレイヤー名  RANK: A        │
│ エネルギー: 1200            │
│ カード所持数: 45/100        │
├─────────────────────────────┤
│ [START MISSION]             │
│ [DECK EDIT]                 │
│ [MATERIALIZE (ガチャ)]       │
│ [CARD CATALOG]              │
│ [ACHIEVEMENTS]              │
│ [LOGOUT]                    │
└─────────────────────────────┘
```

#### 3. エリア選択画面
```
┌─────────────────────────────┐
│        SELECT AREA          │
├──────┬──────┬──────┬────────┤
│ 1.物質│ 2.化学│ 3.物質│ 4.化学│
│ の構成│  結合 │の状態│  反応 │
│  ⭐⭐⭐│  🔒  │  🔒  │  🔒  │
└──────┴──────┴──────┴────────┘
```

#### 4. バトル画面（3Dパース）
```
┌─────────────────────────────┐
│ ⚡3  [ABORT]            HP█ │
├─────────────────────────────┤
│         [BOSS]              │
│      HP: ████████           │
│                             │
│    [FIELD ZONE]             │
│                             │
│   ┌───┐┌───┐┌───┐          │
│   │塩酸││水││鉄 │  (手札)    │
│   └───┘└───┘└───┘          │
│   DECK[15]  GRAVE[5]        │
└─────────────────────────────┘
```

#### 5. デッキ編集画面
```
┌─────────────────────────────┐
│   DECK SLOT 1 [▼]           │
├──────────┬──────────────────┤
│          │ [所持カード]     │
│  DECK    │ ┌──┐┌──┐┌──┐   │
│ (20/20)  │ │塩酸││硫酸││鉄 │   │
│ ┌──┐    │ └──┘└──┘└──┘   │
│ │塩酸│    │ (ドラッグ可能)   │
│ └──┘    │                  │
└──────────┴──────────────────┘
```

#### 6. カード図鑑
```
┌─────────────────────────────┐
│   CARD CATALOG (45/100)     │
├──────┬──────┬──────┬────────┤
│ 塩酸 │ 硫酸 │  ?   │   ?    │
│ Lv.5 │ Lv.2 │      │        │
│ 2/2  │ 1/2  │      │        │
└──────┴──────┴──────┴────────┘
※ 所持カードのみ表示、未所持はシルエット
```

#### 7. カード詳細モーダル
```
┌─────────────────────────────┐
│       塩酸 [ACID]           │
│       ⭐⭐ (RARE)           │
├─────────────────────────────┤
│   [3D MODEL / 化学式 HCl]   │
├─────────────────────────────┤
│ コスト: 2  ダメージ: 30     │
│ レベル: 5/10                │
│ 所持数: 2/2                 │
├─────────────────────────────┤
│ 【化学解説】                │
│ HClの水溶液。pKa=-7の強酸。  │
│ 胃酸の主成分でもある。       │
│ 工業的には塩化ナトリウムと   │
│ 硫酸から製造される。         │
├─────────────────────────────┤
│ [UPGRADE] [CLOSE]           │
└─────────────────────────────┘
```

### アニメーション・エフェクト
- **カード使用**: スライドアップ → フィールドに配置 → 爆発エフェクト
- **ダメージ**: 赤フラッシュ + シェイク + ダメージ数値浮遊
- **コンボ**: 金色の「⚡ COMBO!」文字 + スロー演出
- **レアリティ別演出**:
  - COMMON: 白い光
  - RARE: 青い光 + 小さな星
  - EPIC: 紫の光 + 渦巻き
  - LEGENDARY: 虹色の光 + 画面全体発光

### レスポンシブ対応
- **PC**: 横画面、手札を扇状に配置
- **モバイル**: 縦画面、手札を横一列に配置
- **ブレークポイント**: 768px

---

## データ構造

### Firestore スキーマ

#### users コレクション
```javascript
{
  uid: String,              // Firebase UID
  name: String,             // プレイヤー名
  email: String,            // メールアドレス
  energy: Number,           // エネルギー
  coins: Number,            // コイン（強化用通貨）
  rank: String,             // ランク (F-S)
  totalWins: Number,        // 累計勝利数
  totalLosses: Number,      // 累計敗北数
  collection: [             // 所持カード
    {
      cardId: Number,       // カードID
      level: Number,        // 強化レベル
      count: Number         // 所持枚数
    }
  ],
  decks: [                  // デッキ構成（5スロット）
    {
      name: String,         // デッキ名
      cards: [Number]       // カードID配列（20枚）
    }
  ],
  storyProgress: {          // ストーリー進行度
    clearedAreas: [Number], // クリア済みエリアID
    currentArea: Number     // 現在エリア
  },
  achievements: [           // アチーブメント
    {
      id: Number,
      unlockedAt: Timestamp
    }
  ],
  battleStats: {            // バトル統計
    totalDamage: Number,
    totalHealed: Number,
    comboCount: Number,
    cardUsageCount: {       // カードID別使用回数
      "1": 45,
      "2": 30
    }
  },
  createdAt: Timestamp,
  lastLogin: Timestamp
}
```

#### quizzes コレクション
```javascript
{
  id: Number,
  question: String,
  options: [String],        // 4択
  answer: Number,           // 正解インデックス (0-3)
  category: String,         // カテゴリ
  difficulty: String,       // "normal" | "hard"
  explanation: String       // 解説（オプション）
}
```

#### cards マスターデータ（Firestoreまたはローカル定数）
```javascript
{
  id: Number,
  name: String,
  type: String,
  val: Number,
  cost: Number,
  img: String,
  rarity: String,
  effectType: String,
  target: String,
  combo: {
    type: String,
    count: Number
  },
  comboBonus: {
    val: Number,
    effect: String,
    value: Number
  },
  description: String,
  chemInfo: String
}
```

#### achievements マスターデータ
```javascript
{
  id: Number,
  name: String,             // 例: "酸の使い手"
  description: String,      // 例: "ACIDカードを10回使用"
  condition: {
    type: String,           // "cardUsage" | "winStreak" | "collection" など
    target: Any,            // カードID、数値など
    value: Number           // 達成条件値
  },
  reward: {
    energy: Number,
    coins: Number,
    cardId: Number          // 限定カード（オプション）
  }
}
```

---

## リリース計画

### MVP (Minimum Viable Product) - 1ヶ月後リリース

#### 含まれる機能
✅ Google認証
✅ ホーム画面
✅ エリア選択（3エリア実装）
✅ バトルシステム（基本）
✅ クイズシステム（30問）
✅ カードシステム（30枚）
✅ デッキ編集
✅ カード図鑑
✅ ガチャシステム
✅ カード強化システム
✅ ランクシステム（F-D）
✅ アチーブメント（10個）
✅ ストーリーモード（3エリア分）
✅ Firebase連携（データ保存）

#### 含まれない機能（将来的に実装）
❌ オンライン対戦（PvP）
❌ フレンドシステム
❌ 残り9エリア
❌ 70枚以上のカード
❌ 複雑なコンボシステム
❌ 3Dモデル（初期はプレースホルダー）
❌ BGM/効果音

### 開発フェーズ

#### Week 1: 基盤整備
- [ ] ファイル構成の分割（HTML/CSS/JS）
- [ ] Firebase設定の環境変数化
- [ ] データ構造の確定
- [ ] カード30枚のデータ作成
- [ ] クイズ30問のデータ作成

#### Week 2: コアシステム実装
- [ ] バトルシステムのリファクタリング
- [ ] デッキ編集機能
- [ ] カード強化システム
- [ ] ランクシステム

#### Week 3: UI/UX実装
- [ ] エリア選択画面
- [ ] カード図鑑
- [ ] アチーブメント表示
- [ ] ストーリーテキスト

#### Week 4: テスト・調整・デプロイ
- [ ] バランス調整
- [ ] バグフィックス
- [ ] Firebase Hostingへデプロイ
- [ ] 初期リリース

### アップデート計画（不定期）

#### フェーズ2（リリース1-3ヶ月後）
- エリア追加（+3エリア）
- カード追加（+20枚）
- クイズ追加（+30問）
- 複雑なコンボシステム
- アチーブメント追加（+20個）

#### フェーズ3（リリース3-6ヶ月後）
- オンライン対戦（PvP）
- フレンドシステム
- ランク別マッチング
- 残りエリア実装
- 3Dモデル導入

#### フェーズ4（リリース6ヶ月以降）
- カード100枚達成
- クイズ100問達成
- 全12エリア完成
- BGM/効果音実装
- 追加ストーリー

---

## 将来的な拡張

### オンライン対戦（PvP）

#### マッチング方式
- **フレンド対戦**: ユーザーID検索で対戦
- **ランク別マッチング**: ランク±1まで許容

#### 対戦ルール
- 制限時間: カード選択30秒/ターン
- 先攻/後攻: ランダム
- 勝敗: 先に相手のHPを0にした方が勝利

#### 報酬
- 勝利: エネルギー+150、ランクポイント+10
- 敗北: エネルギー+50、ランクポイント-5

### 追加コンテンツ

#### イベントバトル
- 期間限定ボス
- 特殊ルール（特定タイプのカードのみ使用可能など）
- 限定カード報酬

#### デイリーミッション
- 「3回バトルに勝利」 → エネルギー+100
- 「クイズ5問正解」 → コイン+50

#### シーズンパス（マネタイズ検討時）
- 無料パス: 基本報酬
- 有料パス: 追加報酬、限定カード

---

## 技術的考慮事項

### パフォーマンス最適化
- カード画像の遅延読み込み
- Firestoreクエリの最適化（インデックス活用）
- アニメーションのGPU加速（`transform`, `opacity`使用）

### セキュリティ
- Firebase Rulesでユーザーデータ保護
- APIキーの環境変数化（`.env`ファイル）
- XSS対策（ユーザー入力のサニタイゼーション）

### エラーハンドリング
- ネットワークエラー時のリトライ機構
- オフライン時の警告表示
- Firebaseエラーのユーザーフレンドリーな表示

### テスト
- 手動テスト（初期リリース）
- 将来的にユニットテスト導入検討（Jest等）

---

## 付録

### 用語集
- **マナ**: カードを使うためのリソース
- **コンボ**: 特定条件で発動する追加効果
- **バフ**: 一時的な強化効果
- **デバフ**: 一時的な弱体化効果
- **フィールド履歴**: 最近使用されたカード5枚の記録

### 参考資料
- 高校化学教科書（数研出版、東京書籍等）
- 化学便覧
- 周期表

### 変更履歴
| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-12-09 | 1.0 | 初版作成 |

---

**END OF SPECIFICATION**