<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBER CHEM MOBILE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap" rel="stylesheet">
    <style>
        /* --- CSS„Ç®„É™„Ç¢ --- */
        :root {
            --primary: #00f3ff;
            --accent: #ff0055;
            --bg-dark: #050510;
            --glass: rgba(0, 20, 40, 0.85);
        }

        body {
            background-color: var(--bg-dark);
            /* „Çµ„Ç§„Éê„Éº„Ç∞„É™„ÉÉ„ÉâËÉåÊôØ */
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0; padding: 0; color: #fff;
            font-family: 'Orbitron', sans-serif;
            height: 100dvh; /* „Çπ„Éû„Éõ„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂØæÁ≠ñ */
            width: 100vw;
            overflow: hidden; /* „Çπ„ÇØ„É≠„Éº„É´ÂÆåÂÖ®Á¶ÅÊ≠¢ */
            display: flex; justify-content: center;
        }

        /* ÁîªÈù¢„Ç≥„É≥„ÉÜ„Éä */
        .screen {
            width: 100%; height: 100%; max-width: 500px; /* „Çπ„Éû„ÉõÂπÖÂà∂Èôê */
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column;
            background: transparent;
            visibility: hidden; opacity: 0; transition: opacity 0.3s;
            z-index: 10;
        }
        .screen.active { visibility: visible; opacity: 1; z-index: 20; }

        /* --- UI„Éë„Éº„ÉÑ --- */
        .hud-top {
            position: absolute; top: 0; left: 0; width: 100%; height: 50px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box; z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }
        .energy-badge {
            color: #ffd700; border: 1px solid #ffd700; padding: 2px 10px;
            border-radius: 15px; font-size: 0.8rem; background: rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 5px;
        }

        /* „Éú„Çø„É≥È°û */
        .cyber-btn {
            background: rgba(0, 243, 255, 0.1); border: 1px solid var(--primary);
            color: var(--primary); padding: 15px; width: 80%; margin: 10px auto;
            text-align: center; font-weight: bold; cursor: pointer;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: 0.2s; text-transform: uppercase; letter-spacing: 2px;
        }
        .cyber-btn:active { background: var(--primary); color: #000; transform: scale(0.98); }
        .btn-red { border-color: var(--accent); color: var(--accent); background: rgba(255, 0, 85, 0.1); }
        .btn-red:active { background: var(--accent); color: #fff; }

        /* --- „Çø„Ç§„Éà„É´ÁîªÈù¢ --- */
        #title-screen { justify-content: center; align-items: center; }
        .title-text {
            font-size: 3rem; line-height: 1; text-align: center; margin-bottom: 40px;
            text-shadow: 0 0 10px var(--primary);
            background: linear-gradient(to bottom, #fff, var(--primary));
            -webkit-background-clip: text; color: transparent;
        }

        /* --- „Éê„Éà„É´„Éï„Ç£„Éº„É´„ÉâÔºà3ÂàÜÂâ≤„É¨„Ç§„Ç¢„Ç¶„ÉàÔºâ --- */
        .battle-layout {
            display: flex; flex-direction: column; height: 100%; width: 100%;
            padding-top: 50px; /* HUDÂàÜ */
            box-sizing: border-box;
        }

        /* 1. Êïµ„Ç®„É™„Ç¢ (‰∏ä30%) */
        .area-enemy {
            flex: 3; display: flex; justify-content: center; align-items: center;
            position: relative; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        /* 2. „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç®„É™„Ç¢ (‰∏≠40%) */
        .area-active {
            flex: 4; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative;
        }
        /* 3. ÊâãÊú≠„Ç®„É™„Ç¢ (‰∏ã30%) */
        .area-hand {
            flex: 3; display: flex; align-items: center;
            overflow-x: auto; /* Ê®™„Çπ„ÇØ„É≠„Éº„É´Ë®±ÂèØ */
            padding: 10px; gap: 10px;
            background: rgba(0,0,0,0.3);
            border-top: 1px solid rgba(0, 243, 255, 0.3);
        }

        /* --- „Ç´„Éº„Éâ„Éá„Ç∂„Ç§„É≥ÔºàÂ∞èÂûãÂåñÔºâ --- */
        .mini-card {
            width: 80px; height: 110px; flex-shrink: 0;
            background: #1a1a2e; border: 1px solid #444; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.7rem; position: relative; cursor: pointer; transition: 0.2s;
        }
        .mini-card.selected { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); transform: translateY(-10px); }
        .mini-card img { width: 40px; height: 40px; object-fit: contain; margin-bottom: 5px; }
        
        /* Êà¶ÈóòÁî®„Ç´„Éº„ÉâÔºà‰∏≠ÂûãÔºâ */
        .battle-card {
            width: 140px; height: 200px;
            border: 2px solid var(--primary); border-radius: 10px;
            background: rgba(10, 20, 30, 0.9);
            display: flex; flex-direction: column; padding: 10px; box-sizing: border-box;
            position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: transform 0.3s;
        }
        .enemy-card-style { border-color: var(--accent); transform: scale(0.9); }
        .bc-name { font-size: 0.9rem; font-weight: bold; text-align: center; color: #fff; margin-bottom: 5px;}
        .bc-img { flex: 1; background: #000; border-radius: 4px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .bc-img img { width: 100%; height: 100%; object-fit: cover; }
        .bc-stats { display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 5px; }

        /* „É≠„Ç∞„Éª„É°„ÉÉ„Çª„Éº„Ç∏ */
        .battle-log {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            width: 90%; text-align: center; font-size: 0.8rem; color: var(--primary);
            text-shadow: 0 0 5px var(--primary); pointer-events: none;
        }
        .turn-indicator {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); border: 1px solid #fff; padding: 10px 30px;
            font-size: 1.2rem; font-weight: bold; z-index: 50; display: none;
        }

        /* ÊîªÊíÉ„Éú„Çø„É≥ */
        #attack-btn {
            position: absolute; bottom: 20px;
            background: var(--accent); border: none; color: white;
            padding: 10px 40px; border-radius: 20px; font-weight: bold; font-family: 'Orbitron';
            box-shadow: 0 0 15px var(--accent); cursor: pointer; display: none;
            z-index: 30;
        }
        #attack-btn:active { transform: scale(0.95); }

        /* „ÉÄ„É°„Éº„Ç∏ÊºîÂá∫ÔºàÈ£õ„Å≥Âá∫„ÅôÊï∞Â≠óÔºâ */
        .floating-damage {
            position: absolute; color: #ff0055; font-size: 2rem; font-weight: 900;
            text-shadow: 0 0 5px #fff; pointer-events: none;
            animation: floatUp 1s ease-out forwards; z-index: 100;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-50px) scale(1.5); opacity: 0; } }

        /* ÊîªÊíÉ„Ç®„Éï„Çß„ÇØ„Éà */
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }

        /* Ê±éÁî®„É¢„Éº„ÉÄ„É´ */
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200;
        }
        .modal-box {
            background: #111; border: 1px solid var(--primary); padding: 20px;
            width: 85%; max-width: 350px; text-align: center; border-radius: 10px;
        }
        .input-field {
            background: #222; border: 1px solid #555; color: white; padding: 10px;
            width: 80%; font-family: 'Orbitron'; text-align: center; margin: 15px 0;
        }
    </style>
</head>
<body>

    <div class="hud-top">
        <div onclick="goTitle()" style="font-weight:bold; cursor:pointer;">&lt; EXIT</div>
        <div class="energy-badge">‚ö° <span id="energy-display">0</span></div>
    </div>

    <div id="title-screen" class="screen active" style="z-index: 50;">
        <div class="title-text">CYBER<br>CHEM<br>MOBILE</div>
        
        <div id="login-form" style="width:100%; text-align:center;">
            <input type="text" id="username" class="input-field" placeholder="PLAYER NAME">
            <div class="cyber-btn" onclick="login()">LOGIN</div>
        </div>

        <div id="menu-form" style="width:100%; text-align:center; display:none;">
            <p style="color:#aaa; font-size:0.8rem;">USER: <span id="user-display"></span></p>
            <div class="cyber-btn" onclick="goToBattle('cpu')">‚öîÔ∏è CPU BATTLE</div>
            <div class="cyber-btn" onclick="showRoomInput()">üì° ONLINE (BETA)</div>
            <div class="cyber-btn" style="border-color:#ffd700; color:#ffd700;" onclick="goToGacha()">‚ú® GACHA</div>
        </div>
    </div>

    <div id="room-screen" class="screen">
        <h2 style="margin-top:100px; color:var(--primary);">ONLINE LOBBY</h2>
        <p>Enter Room ID to connect</p>
        <input type="text" id="room-id" class="input-field" placeholder="ROOM ID (e.g. 1234)">
        <div class="cyber-btn" onclick="connectRoom()">CONNECT</div>
        <p id="connect-status" style="color:#aaa; font-size:0.8rem; margin-top:20px;"></p>
    </div>

    <div id="battle-screen" class="screen">
        <div class="battle-layout">
            
            <div class="area-enemy">
                <div id="enemy-card" class="battle-card enemy-card-style">
                    <div class="bc-name">ENEMY: ÊøÉÁ°´ÈÖ∏</div>
                    <div class="bc-img"><img src="https://placehold.co/100x100/333/FFF?text=H2SO4" alt=""></div>
                    <div class="bc-stats">
                        <span style="color:var(--accent);">HP <span id="enemy-hp">200</span></span>
                    </div>
                </div>
                <div id="enemy-msg" style="position:absolute; top:10px; right:10px; background:#fff; color:#000; padding:5px 10px; border-radius:10px; font-size:0.7rem; display:none;">Thinking...</div>
            </div>

            <div class="battle-log" id="battle-log">BATTLE START</div>
            
            <div id="turn-indicator" class="turn-indicator">PLAYER TURN</div>

            <div class="active-area" id="active-area">
                <div style="color:#555; font-size:0.8rem;">SELECT CARD FROM HAND</div>
            </div>

            <button id="attack-btn" onclick="playerAttack()">ATTACK</button>

            <div class="area-hand" id="hand-container">
                </div>
        </div>
    </div>

    <div id="gacha-modal" class="modal">
        <div class="modal-box">
            <h2 style="color:#ffd700;">NEW DATA ACQUIRED</h2>
            <div id="gacha-result" style="margin:20px 0;"></div>
            <div class="cyber-btn" onclick="closeModal('gacha-modal')">CLOSE</div>
        </div>
    </div>

    <script>
        // --- „Éá„Éº„Çø ---
        const cards = [
            {id:1, name:"Ê∞¥Á¥†", hp:60, atk:40, img:"H‚ÇÇ"},
            {id:2, name:"ÈªíÈâõ", hp:70, atk:35, img:"C"},
            {id:3, name:"Â°©ÈÖ∏", hp:90, atk:55, img:"HCl"},
            {id:4, name:"„Ç¢„É≥„É¢„Éã„Ç¢", hp:100, atk:45, img:"NH‚ÇÉ"},
            {id:5, name:"„Éô„É≥„Çº„É≥", hp:150, atk:80, img:"C‚ÇÜH‚ÇÜ"},
            {id:6, name:"ÁéãÊ∞¥", hp:160, atk:100, img:"AuÊ∫∂"}
        ];

        let myDeck = [];
        let energy = 500;
        let selectedInfo = null;
        let enemyHp = 200;
        let isPlayerTurn = true;

        // --- ÂàùÊúüÂåñ ---
        function login() {
            const name = document.getElementById('username').value;
            if(!name) return alert("NAME REQUIRED");
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('menu-form').style.display = 'block';
            document.getElementById('user-display').innerText = name;
            
            // Á∞°Êòì„Éá„Éº„Çø„É≠„Éº„Éâ
            myDeck = [cards[0], cards[1], cards[2], cards[3], cards[4]]; // ÊâãÊåÅ„Å°5Êûö
            updateEnergy();
        }

        function updateEnergy() { document.getElementById('energy-display').innerText = energy; }

        // --- ÁîªÈù¢ÈÅ∑Áßª ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function goTitle() { showScreen('title-screen'); }

        // --- „Ç™„É≥„É©„Ç§„É≥Ôºà„É¢„ÉÉ„ÇØÔºâ ---
        function showRoomInput() { showScreen('room-screen'); }
        function connectRoom() {
            const id = document.getElementById('room-id').value;
            const status = document.getElementById('connect-status');
            if(!id) return;
            status.innerText = "Connecting to Satellite...";
            setTimeout(() => {
                status.innerText = "Error: Server Offline (Demo Mode)";
                setTimeout(() => goToBattle('online_demo'), 1000);
            }, 1000);
        }

        // --- „Éê„Éà„É´„É≠„Ç∏„ÉÉ„ÇØ ---
        function goToBattle(mode) {
            showScreen('battle-screen');
            enemyHp = 200;
            isPlayerTurn = true;
            updateEnemyHp();
            renderHand();
            document.getElementById('active-area').innerHTML = `<div style="color:#555; font-size:0.8rem;">SELECT CARD</div>`;
            document.getElementById('attack-btn').style.display = 'none';
            log("BATTLE START - PLAYER TURN");
            showTurn("PLAYER TURN");
        }

        function renderHand() {
            const container = document.getElementById('hand-container');
            container.innerHTML = "";
            myDeck.forEach(c => {
                const el = document.createElement('div');
                el.className = 'mini-card';
                el.innerHTML = `
                    <div style="font-size:1.5rem; color:#00f3ff;">${c.img}</div>
                    <div>${c.name}</div>
                    <div style="font-size:0.6rem; color:#aaa;">ATK:${c.atk}</div>
                `;
                el.onclick = () => selectCard(c, el);
                container.appendChild(el);
            });
        }

        function selectCard(card, el) {
            if(!isPlayerTurn) return;
            // ÈÅ∏Êäû„Çπ„Çø„Ç§„É´
            document.querySelectorAll('.mini-card').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');

            selectedInfo = card;
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç®„É™„Ç¢„Å´Ë°®Á§∫
            const activeDiv = document.getElementById('active-area');
            activeDiv.innerHTML = `
                <div class="battle-card" style="border-color:#00f3ff;">
                    <div class="bc-name">${card.name}</div>
                    <div class="bc-img" style="font-size:2rem; color:#fff;">${card.img}</div>
                    <div class="bc-stats">
                        <span>ATK ${card.atk}</span>
                    </div>
                </div>
            `;
            
            // „Éú„Çø„É≥Ë°®Á§∫
            const btn = document.getElementById('attack-btn');
            btn.style.display = 'block';
            btn.innerText = `ATTACK (${card.atk})`;
        }

        function playerAttack() {
            if(!isPlayerTurn || !selectedInfo) return;
            isPlayerTurn = false;
            document.getElementById('attack-btn').style.display = 'none';

            // ÊîªÊíÉÂá¶ÁêÜ
            const dmg = selectedInfo.atk;
            enemyHp -= dmg; if(enemyHp < 0) enemyHp = 0;
            
            // ÊºîÂá∫
            showDamage(dmg, 'area-enemy');
            document.getElementById('enemy-card').classList.add('shake');
            setTimeout(() => document.getElementById('enemy-card').classList.remove('shake'), 400);
            updateEnemyHp();
            log(`PLAYER ATTACK! ${dmg} DAMAGE`);

            if(enemyHp <= 0) {
                setTimeout(() => { alert("YOU WIN!"); goTitle(); }, 1000);
            } else {
                // CPU„Çø„Éº„É≥„Å∏
                setTimeout(cpuTurn, 1500);
            }
        }

        function cpuTurn() {
            showTurn("CPU TURN");
            log("CPU IS THINKING...");
            
            const msg = document.getElementById('enemy-msg');
            msg.style.display = 'block';
            msg.innerText = "Analyzing...";

            // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÊîªÊíÉ
            setTimeout(() => {
                msg.style.display = 'none';
                const dmg = 30; // Âõ∫ÂÆö„ÉÄ„É°„Éº„Ç∏
                
                // „Éó„É¨„Ç§„É§„ÉºÂÅ¥„ÅÆ„Ç´„Éº„Éâ„ÇíÊè∫„Çâ„Åô
                const activeCard = document.querySelector('#active-area .battle-card');
                if(activeCard) {
                    activeCard.classList.add('shake');
                    showDamage(dmg, 'active-area');
                    setTimeout(() => activeCard.classList.remove('shake'), 400);
                } else {
                    showDamage(dmg, 'active-area'); // „Ç´„Éº„ÉâÂá∫„Åó„Å¶„Å™„Åè„Å¶„ÇÇ„ÉÄ„É°„Éº„Ç∏
                }

                log(`CPU ATTACK! ${dmg} DAMAGE`);
                
                // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å∏Êàª„Åô
                setTimeout(() => {
                    isPlayerTurn = true;
                    showTurn("PLAYER TURN");
                    log("YOUR TURN");
                }, 1500);

            }, 2000); // ÊÄùËÄÉÊôÇÈñì
        }

        // --- „Éò„É´„Éë„Éº ---
        function updateEnemyHp() { document.getElementById('enemy-hp').innerText = enemyHp; }
        function log(text) { document.getElementById('battle-log').innerText = text; }
        
        function showTurn(text) {
            const el = document.getElementById('turn-indicator');
            el.innerText = text;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 1000);
        }

        function showDamage(val, areaId) {
            const area = document.querySelector('.' + areaId);
            const el = document.createElement('div');
            el.className = 'floating-damage';
            el.innerText = "-" + val;
            // ‰∏≠Â§Æ‰ªòËøë„Å´ÈÖçÁΩÆ
            el.style.left = "50%";
            el.style.top = "50%";
            el.style.transform = "translate(-50%, -50%)";
            area.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // --- „Ç¨„ÉÅ„É£ ---
        function goToGacha() {
            if(energy < 300) return alert("NEED 300 ENERGY");
            energy -= 300; updateEnergy();
            const result = cards[Math.floor(Math.random() * cards.length)];
            myDeck.push(result);
            document.getElementById('gacha-result').innerHTML = `
                <div style="font-size:2rem; color:#00f3ff;">${result.img}</div>
                <h3>${result.name}</h3>
                <p>ATK: ${result.atk}</p>
            `;
            document.getElementById('gacha-modal').style.display = 'flex';
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    </script>
</body>
</html>