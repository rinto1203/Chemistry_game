<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COSMIC CHEMISTRY: DECK</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Zen+Dots&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="scanline"></div>
    <div id="loading">SYSTEM BOOT...</div>
    <div id="red-flash" class="red-flash"></div>

    <!-- Login Screen -->
    <div id="screen-login" class="screen active" style="justify-content:center;">
        <div class="login-box">
            <h1 style="font-size:3rem; margin:0; line-height:1; color:#fff; text-shadow:0 0 20px var(--c-cyan);">
                COSMIC<br><span style="color:var(--c-cyan)">CHEMISTRY</span>
            </h1>
            <p style="color:#888; letter-spacing:3px;">CLOUD SYNC</p>
            <button class="google-btn" onclick="app.loginGoogle()">Sign in with Google</button>
        </div>
    </div>

    <!-- Home Screen -->
    <div id="screen-home" class="screen" style="padding-top:80px;">
        <div class="home-container">
            <div class="profile-panel">
                <div><small style="color:#aaa;">PILOT</small><div style="font-size:2rem; font-weight:bold;" id="home-name">...</div></div>
                <div style="font-size:2rem; color:var(--c-gold);">RANK F</div>
            </div>
            <div class="stat-grid">
                <div class="stat-card"><small>ENERGY</small><div style="font-size:1.5rem; color:var(--c-cyan);" id="home-energy">0</div></div>
                <div class="stat-card"><small>CARDS</small><div style="font-size:1.5rem;" id="home-cards">0</div></div>
            </div>
            <button class="btn-primary" style="width:100%; margin-bottom:15px;" onclick="app.nav('area')">START MISSION</button>
            <button class="btn-primary" style="width:100%; margin-bottom:15px;" onclick="app.nav('deck')">DECK EDIT</button>
            <button class="btn-primary" style="width:100%; margin-bottom:15px;" onclick="app.nav('upgrade')">UPGRADE</button>
            <button class="btn-primary" style="width:100%; margin-bottom:15px;" onclick="app.nav('achievements')">ACHIEVEMENTS</button>
            <button class="btn-primary btn-gold" style="width:100%;" onclick="app.nav('gacha')">MATERIALIZE</button>
            <button class="btn-primary btn-red" style="width:100%; margin-top:30px;" onclick="app.logout()">LOGOUT</button>
        </div>
    </div>

    <!-- Battle Screen -->
    <div id="screen-battle" class="screen" style="padding:0;">
        <div class="hud-top">
            <div class="energy-display"><span id="battle-energy">0</span></div>
            <button class="btn-primary btn-red" style="padding:5px 15px; font-size:0.8rem;" onclick="app.nav('home')">ABORT</button>
        </div>

        <div class="battle-stage" id="battle-stage-div">
            <div class="zone-enemy">
                <div class="enemy-hand" id="e-hand"></div>
                <div class="boss-frame" id="enemy-visual">
                    <img src="https://placehold.co/100x150/300/f05?text=BOSS" style="width:100%; height:100%; object-fit:cover; opacity:0.8;">
                </div>
                <div class="hp-bar-track"><div id="hp-e" class="hp-fill hp-e" style="width:100%;"></div></div>
            </div>

            <div class="zone-field">
                <div class="field-slot" id="field-card"><div>ZONE</div></div>
                <div id="cut-in" class="cut-in">ENEMY ATTACK!</div>
            </div>

            <div class="zone-player">
                <div class="player-stats">
                    <div>
                        <small style="color:#aaa;">HP</small>
                        <div class="hp-bar-track"><div id="hp-p" class="hp-fill hp-p" style="width:100%;"></div></div>
                        <span id="hp-val-p">200</span>
                    </div>
                    <div style="text-align:right;">
                        <small style="color:#aaa;">MANA</small>
                        <div style="font-size:1.5rem; font-weight:bold; color:var(--c-cyan);" id="mana-val">0</div>
                    </div>
                </div>
                <div class="hand-container" id="p-hand"></div>

                <div class="deck-zone">
                    <div class="deck-count" id="deck-count">20</div>
                </div>
                <div class="grave-zone"></div>
            </div>
        </div>
    </div>

    <!-- Area Select Screen -->
    <div id="screen-area" class="screen">
        <div class="area-select-container">
            <h2 style="color:var(--c-cyan); margin-bottom:10px;">SELECT AREA</h2>
            <p style="color:#888; font-size:0.9rem;">Choose your battlefield</p>
            <div class="area-grid" id="area-grid"></div>
            <button class="btn-primary" style="margin-top:30px;" onclick="app.nav('home')">BACK</button>
        </div>
    </div>

    <!-- Upgrade Screen -->
    <div id="screen-upgrade" class="screen">
        <div class="upgrade-container">
            <h2 style="color:var(--c-gold); margin-bottom:10px;">CARD UPGRADE</h2>
            <p style="color:#888; font-size:0.9rem;">Consume 2 copies to level up (+5 ATK)</p>
            <div class="upgrade-cards" id="upgrade-cards"></div>
            <button class="btn-primary" style="margin-top:30px;" onclick="app.nav('home')">BACK</button>
        </div>
    </div>

    <!-- Achievements Screen -->
    <div id="screen-achievements" class="screen">
        <div class="achievement-container">
            <h2 style="color:var(--c-gold); margin-bottom:10px;">ACHIEVEMENTS</h2>
            <p style="color:#888; font-size:0.9rem;">Complete challenges to earn rewards</p>
            <div class="achievement-list" id="achievement-list"></div>
            <button class="btn-primary" style="margin-top:30px;" onclick="app.nav('home')">BACK</button>
        </div>
    </div>

    <!-- Deck Edit Screen -->
    <div id="screen-deck" class="screen">
        <div class="deck-edit-container">
            <div class="deck-header">
                <div class="deck-slot-selector" id="deck-slots"></div>
                <button class="btn-primary" style="padding:8px 20px;" onclick="app.nav('home')">BACK</button>
            </div>
            <div class="deck-area">
                <div class="deck-panel">
                    <div class="panel-title">DECK <span id="deck-count-display" class="deck-count">0/20</span></div>
                    <div class="deck-cards" id="deck-cards"></div>
                </div>
                <div class="collection-panel">
                    <div class="panel-title">COLLECTION</div>
                    <div class="filter-bar" id="filter-bar"></div>
                    <div class="collection-cards" id="collection-cards"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gacha Screen -->
    <div id="screen-gacha" class="screen" style="justify-content:center; align-items:center;">
        <h2 style="color:var(--c-gold);">MATTER SYNTHESIS</h2>
        <div style="font-size:5rem; color:var(--c-gold); cursor:pointer; text-shadow:0 0 20px var(--c-gold);" onclick="app.gacha()">&#10022;</div>
        <div style="margin-top:20px; font-weight:bold; color:#aaa;">COST: 100 ENERGY</div>
        <button class="btn-primary" style="margin-top:30px;" onclick="app.nav('home')">BACK</button>
    </div>

    <!-- Quiz Modal -->
    <div id="modal-quiz" class="overlay">
        <div class="msg-box">
            <h2 style="color:var(--c-cyan);">ENERGY CHARGE</h2>
            <p id="q-text" style="font-weight:bold; margin:20px 0;">...</p>
            <div id="q-opts" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="modal-msg" class="overlay">
        <div class="msg-box">
            <h2 id="msg-title" style="color:var(--c-cyan);">MESSAGE</h2>
            <p id="msg-text" style="margin:20px 0;">...</p>
            <button class="btn-primary" onclick="document.getElementById('modal-msg').classList.remove('active')">OK</button>
        </div>
    </div>

    <!-- Upgrade Confirmation Modal -->
    <div id="modal-upgrade" class="overlay">
        <div class="upgrade-modal-content">
            <h2 style="color:var(--c-gold);">UPGRADE CARD</h2>
            <div id="upgrade-card-img" style="font-size:3rem; margin:15px 0;">HCl</div>
            <div id="upgrade-card-name" style="font-size:1.2rem; font-weight:bold;">Card Name</div>
            <div class="upgrade-comparison">
                <div class="upgrade-stat">
                    <div class="upgrade-stat-label">LEVEL</div>
                    <div id="upgrade-current-level" class="upgrade-stat-value old">Lv.1</div>
                </div>
                <div class="upgrade-arrow">-></div>
                <div class="upgrade-stat">
                    <div class="upgrade-stat-label">LEVEL</div>
                    <div id="upgrade-new-level" class="upgrade-stat-value new">Lv.2</div>
                </div>
            </div>
            <div class="upgrade-comparison">
                <div class="upgrade-stat">
                    <div class="upgrade-stat-label">ATK</div>
                    <div id="upgrade-current-val" class="upgrade-stat-value old">30</div>
                </div>
                <div class="upgrade-arrow">-></div>
                <div class="upgrade-stat">
                    <div class="upgrade-stat-label">ATK</div>
                    <div id="upgrade-new-val" class="upgrade-stat-value new">35</div>
                </div>
            </div>
            <div class="upgrade-cost-info">Cost: <span id="upgrade-cost">2 copies</span></div>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
                <button class="btn-primary btn-gold" onclick="cardUpgrade.confirmUpgrade()">UPGRADE</button>
                <button class="btn-primary" onclick="cardUpgrade.closeUpgradeModal()">CANCEL</button>
            </div>
        </div>
    </div>

    <!-- Card Detail Modal -->
    <div id="modal-card-detail" class="card-detail-modal">
        <div class="card-detail-content">
            <div id="card-detail-rarity" style="color:var(--c-gold); font-size:0.8rem;">COMMON</div>
            <div id="card-detail-img" class="card-detail-img">HCl</div>
            <div id="card-detail-name" class="card-detail-name">Card Name</div>
            <div id="card-detail-type" class="card-detail-type">ACID</div>
            <div class="card-detail-stats">
                <div class="card-detail-stat">
                    <div class="card-detail-stat-label">COST</div>
                    <div id="card-detail-cost" class="card-detail-stat-value">2</div>
                </div>
                <div class="card-detail-stat">
                    <div class="card-detail-stat-label">VALUE</div>
                    <div id="card-detail-val" class="card-detail-stat-value">30</div>
                </div>
            </div>
            <div id="card-detail-desc" class="card-detail-desc">Description</div>
            <div id="card-detail-chem" class="card-detail-chem">Chemical info</div>
            <div class="card-detail-actions">
                <button class="btn-primary" onclick="deckEditor.closeCardDetail()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Main JavaScript Module -->
    <script type="module" src="src/main.js"></script>
</body>
</html>
