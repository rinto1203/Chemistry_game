<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBER CHEM 3D</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff0055;
            --neon-yellow: #ffd700;
            --bg-dark: #050b14;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; background-color: var(--bg-dark);
            /* å®‡å®™ç©ºé–“ã®ã‚ˆã†ãªèƒŒæ™¯ */
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 243, 255, 0.05) 0%, transparent 60%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect x="0" y="0" width="1" height="1" fill="white" opacity="0.5"/></svg>');
            background-size: 100% 100%, 200px 200px;
            font-family: 'Roboto', sans-serif; color: #fff;
            height: 100dvh; width: 100vw; overflow: hidden;
            display: flex; flex-direction: column;
            perspective: 1000px; /* â˜…é‡è¦ï¼šã“ã‚ŒãŒ3Dç©ºé–“ã‚’ä½œã‚‹ */
        }

        /* --- ç”»é¢å…¨ä½“ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ --- */
        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px; z-index: 1000; opacity: 0.3;
        }

        /* --- å…±é€šã‚³ãƒ³ãƒ†ãƒŠ --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; transition: 0.5s;
        }
        .screen.active { display: flex; opacity: 1; }

        /* --- ã‚¬ã‚¤ãƒ‰ãƒãƒ¼ (æ¬¡ã«ä½•ã‚’ã™ã‚‹ã‹æŒ‡ç¤º) --- */
        .guide-bar {
            position: fixed; top: 15%; width: 90%; max-width: 400px;
            background: rgba(0,0,0,0.8); border: 1px solid var(--neon-blue);
            padding: 10px; text-align: center; font-weight: bold; font-size: 1.1rem;
            color: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue);
            z-index: 200; border-radius: 8px;
            animation: pulseText 1.5s infinite;
        }
        @keyframes pulseText { 0%{opacity:0.8;} 50%{opacity:1; text-shadow:0 0 10px var(--neon-blue);} 100%{opacity:0.8;} }

        /* --- ãƒãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (3D) --- */
        .battle-stage {
            width: 100%; height: 100%;
            transform: rotateX(20deg) translateY(-20px); /* â˜…ç›¤é¢ã‚’å¥¥ã«å€’ã™ */
            transform-style: preserve-3d;
            display: flex; flex-direction: column;
        }

        /* æ•µã‚¨ãƒªã‚¢ */
        .zone-enemy {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 20px;
        }
        .enemy-card {
            width: 140px; height: 190px; background: #200; border: 3px solid var(--neon-pink);
            border-radius: 12px; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.5); position: relative;
            transform: translateZ(20px); /* æµ®ãä¸ŠãŒã‚‰ã›ã‚‹ */
        }
        .enemy-img { font-size: 4rem; margin-top: 20px; }
        .enemy-hp-bar {
            width: 120px; height: 10px; background: #333; margin-top: 10px;
            border-radius: 5px; overflow: hidden;
        }
        .enemy-hp-fill { width: 100%; height: 100%; background: var(--neon-pink); transition: width 0.3s; }

        /* ä¸­å¤®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .zone-field {
            flex: 1; display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        /* ã‚«ãƒ¼ãƒ‰ã‚’ç½®ãå°åº§ */
        .slot-base {
            width: 120px; height: 170px; border: 2px dashed rgba(0, 243, 255, 0.3);
            border-radius: 12px; transform: rotateX(40deg); /* åœ°é¢ã«æã‹ã‚Œã¦ã„ã‚‹æ„Ÿ */
            background: rgba(0, 243, 255, 0.05); display: flex; justify-content: center; align-items: center;
            color: rgba(0, 243, 255, 0.5); font-size: 0.8rem;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ */
        .zone-player {
            height: 250px; position: relative; transform-style: preserve-3d;
        }
        
        /* æ‰‹æœ­ã‚¨ãƒªã‚¢ */
        .hand-container {
            position: absolute; bottom: 10px; width: 100%; height: 180px;
            display: flex; justify-content: center; align-items: flex-end;
            transform-style: preserve-3d;
        }

        /* --- ã‚«ãƒ¼ãƒ‰æœ¬ä½“ (3D) --- */
        .card {
            width: 110px; height: 160px;
            background: linear-gradient(135deg, #1a1a2e, #0f0c29);
            border: 2px solid #444; border-radius: 10px;
            position: relative; margin: 0 -15px; /* é‡ã­ã‚‹ */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center bottom;
            box-shadow: -5px 5px 15px rgba(0,0,0,0.5);
            cursor: pointer; display: flex; flex-direction: column; padding: 5px;
        }
        /* ãƒ›ãƒãƒ¼æ™‚ãƒ»é¸æŠæ™‚ */
        .card:hover, .card.selected {
            transform: translateY(-60px) scale(1.2) rotateX(0deg) !important;
            z-index: 100; margin: 0 20px;
            box-shadow: 0 0 30px var(--neon-blue); border-color: var(--neon-blue);
        }
        .card.disabled { filter: grayscale(1) brightness(0.4); pointer-events: none; }

        /* ã‚«ãƒ¼ãƒ‰ã®ä¸­èº« */
        .c-cost {
            position: absolute; top: -5px; left: -5px; width: 24px; height: 24px;
            background: var(--neon-blue); color: #000; font-weight: bold; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; box-shadow: 0 0 5px var(--neon-blue);
        }
        .c-img { flex: 1; background: #000; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; border: 1px solid #333; margin-top: 5px; }
        .c-name { font-size: 0.7rem; color: #fff; font-weight: bold; margin: 3px 0; text-align: center; }
        .c-val { font-size: 1.2rem; font-weight: 900; color: var(--neon-yellow); text-align: right; text-shadow: 0 0 5px black; }

        /* --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --- */
        #action-btn {
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
            background: var(--neon-pink); color: white; border: none;
            padding: 15px 50px; font-size: 1.5rem; font-family: 'Black Ops One', cursive;
            border-radius: 50px; cursor: pointer; display: none; z-index: 200;
            box-shadow: 0 0 20px var(--neon-pink);
            animation: bounce 1s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.1); } }

        /* --- ã‚¯ã‚¤ã‚ºUI (ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤) --- */
        .quiz-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 500; display: none;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .quiz-box {
            width: 90%; max-width: 400px; background: #111; border: 2px solid var(--neon-blue);
            padding: 20px; border-radius: 15px; text-align: center;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.3);
        }
        .quiz-btn {
            width: 100%; padding: 15px; margin-top: 10px; background: #222; border: 1px solid #444;
            color: #fff; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .quiz-btn:hover { background: var(--neon-blue); color: #000; }

        /* --- ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡º --- */
        .damage-txt {
            position: absolute; font-size: 4rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 10px var(--neon-pink); pointer-events: none; z-index: 1000;
            animation: dmgPop 0.8s forwards;
        }
        @keyframes dmgPop { 0%{transform:translate(-50%,0) scale(0);} 50%{transform:translate(-50%,-50px) scale(1.5);} 100%{transform:translate(-50%,-100px) scale(1); opacity:0;} }

        /* --- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ --- */
        .title-logo {
            font-family: 'Black Ops One', cursive; font-size: 3.5rem;
            text-align: center; color: var(--neon-blue); text-shadow: 0 0 20px var(--neon-blue);
        }
        .start-btn {
            margin-top: 50px; padding: 20px 60px; font-size: 1.5rem; font-weight: bold;
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            cursor: pointer; transition: 0.3s;
        }
        .start-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 30px var(--neon-blue); }

        /* HUD */
        .hud-energy {
            position: fixed; top: 20px; right: 20px; font-size: 1.5rem; font-weight: bold;
            color: var(--neon-yellow); text-shadow: 0 0 10px var(--neon-yellow); z-index: 100;
            display: flex; gap: 10px; align-items: center;
        }
        .mana-pip { width: 15px; height: 25px; background: #333; border: 1px solid #666; transform: skewX(-20deg); }
        .mana-pip.on { background: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); border-color: #fff; }

    </style>
</head>
<body>

    <div class="scanline"></div>

    <div id="screen-title" class="screen active">
        <div class="title-logo">CHEMISTRY<br>DUEL</div>
        <p style="color:#aaa; letter-spacing: 5px;">3D TACTICAL BATTLE</p>
        <button class="start-btn" onclick="startGame()">GAME START</button>
    </div>

    <div id="screen-battle" class="screen">
        
        <div id="guide-text" class="guide-bar">BATTLE START</div>

        <div class="hud-energy">
            <div id="mana-container" style="display:flex; gap:5px;"></div>
        </div>

        <div class="battle-stage">
            <div class="zone-enemy">
                <div class="enemy-card" id="enemy-visual">
                    <div style="width:100%; text-align:center; padding:5px; background:#500; font-weight:bold;">BOSS</div>
                    <div class="enemy-img">ğŸ‘¹</div>
                    <div style="font-weight:bold; margin-top:10px;">æ¿ƒç¡«é…¸</div>
                    <div style="font-size:0.8rem; color:#f88;">ATK: 30</div>
                </div>
                <div class="enemy-hp-bar"><div id="enemy-hp-fill" class="enemy-hp-fill"></div></div>
            </div>

            <div class="zone-field">
                <div class="slot-base" id="field-slot">DRAG CARD HERE</div>
                <button id="action-btn" onclick="executeAttack()">FIRE!!</button>
            </div>

            <div class="zone-player">
                <div class="hand-container" id="hand"></div>
            </div>
        </div>
    </div>

    <div id="screen-quiz" class="quiz-overlay">
        <div class="quiz-box">
            <h2 style="color:var(--neon-blue)">ENERGY CHARGE</h2>
            <p id="q-text" style="font-size:1.2rem; margin:20px 0;">...</p>
            <div id="q-opts"></div>
        </div>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿ ---
        const cards = [
            { name:"æ°´ç´ ", type:"ATK", val:30, cost:1, img:"H" },
            { name:"é»’é‰›", type:"DEF", val:20, cost:1, img:"C" },
            { name:"å¡©é…¸", type:"ATK", val:50, cost:2, img:"HCl" },
            { name:"ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢", type:"HEAL", val:40, cost:2, img:"NH3" },
            { name:"ç‹æ°´", type:"ATK", val:80, cost:3, img:"Au" }
        ];
        const quizzes = [
            { q:"åŸå­ç•ªå·1ç•ªã¯ï¼Ÿ", a:0, o:["æ°´ç´ ","ãƒ˜ãƒªã‚¦ãƒ ","ãƒªãƒã‚¦ãƒ "] },
            { q:"ç‚è‰²åå¿œï¼šèµ¤è‰²ã¯ï¼Ÿ", a:0, o:["ãƒªãƒã‚¦ãƒ ","ãƒŠãƒˆãƒªã‚¦ãƒ ","éŠ…"] },
            { q:"è…åµè‡­ãŒã™ã‚‹ã®ã¯ï¼Ÿ", a:1, o:["é…¸ç´ ","ç¡«åŒ–æ°´ç´ ","å¡©ç´ "] }
        ];

        // --- å¤‰æ•° ---
        let mana = 0; const maxMana = 5;
        let enemyHp = 200; const maxEnemyHp = 200;
        let hand = [];
        let selectedCard = null;

        // --- ã‚²ãƒ¼ãƒ é–‹å§‹ ---
        function startGame() {
            document.getElementById('screen-title').classList.remove('active');
            document.getElementById('screen-battle').classList.add('active');
            
            // æ‰‹æœ­ã‚’é…ã‚‹
            hand = [cards[0], cards[1], cards[2], cards[4]];
            updateBoard();
            
            // æœ€åˆã®ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¯ã‚¤ã‚ºï¼‰
            setTimeout(startQuiz, 1000);
        }

        // --- ç”»é¢æ›´æ–° ---
        function updateBoard() {
            // HP
            document.getElementById('enemy-hp-fill').style.width = (enemyHp/maxEnemyHp*100) + "%";
            
            // Mana
            const mCont = document.getElementById('mana-container');
            mCont.innerHTML = "";
            for(let i=0; i<maxMana; i++) {
                const pip = document.createElement('div');
                pip.className = `mana-pip ${i < mana ? 'on' : ''}`;
                mCont.appendChild(pip);
            }

            // Hand
            const hCont = document.getElementById('hand');
            hCont.innerHTML = "";
            hand.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = "card";
                if(c.cost > mana) div.classList.add('disabled');
                
                // 3Dçš„ãªæ‰‡çŠ¶é…ç½®
                const rotate = (i - (hand.length-1)/2) * 5;
                const transY = Math.abs(i - (hand.length-1)/2) * 10;
                div.style.transform = `rotate(${rotate}deg) translateY(${transY}px)`;

                div.innerHTML = `
                    <div class="c-cost">${c.cost}</div>
                    <div class="c-img">${c.img}</div>
                    <div class="c-name">${c.name}</div>
                    <div class="c-val">${c.type} ${c.val}</div>
                `;
                div.onclick = () => selectCard(c, div);
                hCont.appendChild(div);
            });
        }

        // --- ã‚¯ã‚¤ã‚º ---
        function startQuiz() {
            setGuide("ã‚¯ã‚¤ã‚ºã«ç­”ãˆã¦ã‚¨ãƒŠã‚¸ãƒ¼å……å¡«ï¼");
            const q = quizzes[Math.floor(Math.random()*quizzes.length)];
            document.getElementById('q-text').innerText = q.q;
            const opts = document.getElementById('q-opts');
            opts.innerHTML = "";
            q.o.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = "quiz-btn"; b.innerText = txt;
                b.onclick = () => {
                    document.getElementById('screen-quiz').style.display = 'none';
                    if(i === q.a) {
                        mana = Math.min(maxMana, mana + 2);
                        setGuide("ãƒãƒ£ãƒ¼ã‚¸å®Œäº†ï¼ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¹ï¼");
                    } else {
                        mana = Math.min(maxMana, mana + 1);
                        setGuide("ä¸€éƒ¨ãƒãƒ£ãƒ¼ã‚¸... ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¹ï¼");
                    }
                    updateBoard();
                };
                opts.appendChild(b);
            });
            document.getElementById('screen-quiz').style.display = 'flex';
        }

        // --- ãƒãƒˆãƒ«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
        function selectCard(card, el) {
            if(card.cost > mana) return;
            
            // é¸æŠæ¼”å‡º
            const all = document.querySelectorAll('.card');
            all.forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            
            selectedCard = card;
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã‚’è¡¨ç¤º
            const slot = document.getElementById('field-slot');
            slot.style.border = "2px solid var(--neon-blue)";
            slot.style.boxShadow = "0 0 20px var(--neon-blue)";
            slot.innerHTML = `<div style="font-size:1.5rem; font-weight:bold;">${card.name}</div>`;
            
            document.getElementById('action-btn').style.display = 'block';
            setGuide("ã€ŒFIRE!!ã€ãƒœã‚¿ãƒ³ã§ç™ºå‹•ï¼");
        }

        function executeAttack() {
            if(!selectedCard) return;
            
            mana -= selectedCard.cost;
            document.getElementById('action-btn').style.display = 'none';
            setGuide("æ”»æ’ƒä¸­...");
            updateBoard();

            // æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const slot = document.getElementById('field-slot');
            slot.style.transition = "0.3s";
            slot.style.transform = "rotateX(40deg) translateY(-100px) scale(1.5)";
            
            setTimeout(() => {
                // ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
                const dmg = selectedCard.val;
                enemyHp = Math.max(0, enemyHp - dmg);
                
                // ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡º
                showDamage(dmg);
                
                // æ•µæºã‚Œ
                const enemy = document.getElementById('enemy-visual');
                enemy.style.transform = "translateZ(20px) translateX(10px)";
                setTimeout(() => enemy.style.transform = "translateZ(20px)", 100);

                // ãƒªã‚»ãƒƒãƒˆ
                slot.style.transform = "rotateX(40deg)";
                slot.innerHTML = "WAIT...";
                slot.style.border = "2px dashed rgba(0, 243, 255, 0.3)";
                slot.style.boxShadow = "none";
                selectedCard = null;
                updateBoard();

                if(enemyHp <= 0) {
                    setGuide("VICTORY!!");
                    setTimeout(() => alert("YOU WIN! (Click to Reset)"), 1000); // ç°¡æ˜“ãƒªã‚»ãƒƒãƒˆ
                    setTimeout(() => location.reload(), 2000);
                } else {
                    setTimeout(enemyTurn, 1000);
                }
            }, 500);
        }

        function enemyTurn() {
            setGuide("æ•µã®ã‚¿ãƒ¼ãƒ³...");
            setTimeout(() => {
                setGuide("æ•µã®æ”»æ’ƒï¼ -20ãƒ€ãƒ¡ãƒ¼ã‚¸");
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼HPå‡¦ç†ã¯çœç•¥ï¼ˆä»Šå›ã¯æ•µã‚’å€’ã™ã“ã¨ã«é›†ä¸­ï¼‰
                setTimeout(startQuiz, 1500);
            }, 1500);
        }

        // --- æ¼”å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
        function setGuide(txt) {
            document.getElementById('guide-text').innerText = txt;
        }

        function showDamage(val) {
            const el = document.createElement('div');
            el.className = 'damage-txt';
            el.innerText = val;
            el.style.left = "50%"; el.style.top = "30%";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

    </script>
</body>
</html>