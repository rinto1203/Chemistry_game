<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEM POCKET</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f2f4f8;
            --surface: #ffffff;
            --primary: #3b82f6; /* é’ */
            --accent: #f59e0b;  /* é»„ */
            --danger: #ef4444;  /* èµ¤ */
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --card-ratio: 1.4; /* ã‚«ãƒ¼ãƒ‰æ¯”ç‡ */
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            color: var(--text-main);
            height: 100dvh; width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- ç”»é¢ç®¡ç† --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column;
            background: var(--bg-color);
            padding-bottom: 80px; /* ãƒ•ãƒƒã‚¿ãƒ¼åˆ† */
            animation: fadeIn 0.3s ease;
        }
        .screen.active { display: flex; }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

        /* --- å…±é€šUI --- */
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .app-header {
            padding: 15px 20px; background: var(--surface);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 10;
        }
        .level-badge {
            background: #e0f2fe; color: var(--primary); padding: 4px 12px;
            border-radius: 20px; font-weight: bold; font-size: 0.8rem;
        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ (ãƒã‚±ãƒã‚±é¢¨) */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: var(--surface); border-top: 1px solid #e5e7eb;
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: env(safe-area-inset-bottom); z-index: 100;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--text-sub); font-size: 0.65rem; font-weight: bold;
            width: 60px; cursor: pointer; transition: 0.2s;
        }
        .nav-item.active { color: var(--text-main); transform: translateY(-2px); }
        .nav-icon { font-size: 1.4rem; }

        /* ãƒœã‚¿ãƒ³ */
        .btn-main {
            background: var(--text-main); color: white; border: none;
            padding: 14px; border-radius: 30px; font-weight: bold; font-size: 1rem;
            width: 80%; max-width: 300px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: 0.2s;
        }
        .btn-main:active { transform: scale(0.98); }
        .btn-battle { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-open { background: linear-gradient(135deg, #f59e0b, #d97706); }

        /* --- ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ (ã‚¯ãƒªãƒ¼ãƒ³ï¼†è©³ç´°) --- */
        .card-frame {
            width: 130px; aspect-ratio: 1/1.4;
            background: var(--surface); border-radius: 10px;
            border: 1px solid #e5e7eb;
            position: relative; overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
        }
        /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ¼”å‡º */
        .rarity-2 { border: 2px solid var(--primary); }
        .rarity-3 { border: 2px solid var(--accent); box-shadow: 0 0 15px rgba(245, 158, 11, 0.3); }
        .rarity-3::after {
            content: ""; position: absolute; inset: 0;
            background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.6) 50%, transparent 70%);
            background-size: 200% 100%; animation: shine 3s infinite linear; pointer-events: none;
        }
        @keyframes shine { 0%{background-position: 100% 0} 100%{background-position: -100% 0} }

        .card-inner { padding: 6px; height: 100%; display: flex; flex-direction: column; }
        .c-header { display: flex; justify-content: space-between; align-items: center; font-size: 0.7rem; font-weight: bold; color: var(--text-sub); }
        .c-hp { color: var(--danger); }
        .c-image { 
            flex: 1; background: #f3f4f6; border-radius: 4px; margin: 4px 0; 
            display: flex; justify-content: center; align-items: center; font-size: 2rem;
        }
        .c-name { font-weight: 800; font-size: 0.9rem; text-align: center; margin-bottom: 2px; }
        .c-skill { font-size: 0.65rem; color: var(--text-sub); text-align: center; line-height: 1.2; }
        
        /* æ‹¡å¤§è¡¨ç¤ºæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .card-detail-view {
            width: 260px; aspect-ratio: 1/1.4; transform: scale(1);
            font-size: 1.2rem;
        }

        /* --- ãƒ›ãƒ¼ãƒ ç”»é¢ --- */
        #screen-home { align-items: center; }
        .banner {
            width: 90%; height: 180px; border-radius: 16px; margin-top: 20px;
            background: linear-gradient(135deg, #1f2937, #111827);
            color: white; padding: 20px; position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
        }
        .banner h2 { margin: 0; font-size: 1.5rem; z-index: 2; }
        .banner p { font-size: 0.8rem; opacity: 0.8; z-index: 2; }
        .banner::after {
            content: "CHEM"; position: absolute; right: -20px; bottom: -30px;
            font-size: 6rem; font-weight: 900; opacity: 0.1; transform: rotate(-10deg);
        }

        .collection-preview {
            width: 100%; overflow-x: auto; padding: 20px;
            display: flex; gap: 15px; scrollbar-width: none;
        }

        /* --- ãƒãƒˆãƒ«ç”»é¢ (ãƒã‚±ãƒã‚±é¢¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) --- */
        .battle-board {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            background: #eef2f6; position: relative;
        }
        
        /* ç›¸æ‰‹ã‚¨ãƒªã‚¢ */
        .zone-opponent {
            flex: 1; display: flex; justify-content: center; align-items: center;
            background: #e5e7eb; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            position: relative;
        }
        /* è‡ªåˆ†ã‚¨ãƒªã‚¢ */
        .zone-player {
            flex: 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
        }
        
        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚«ãƒ¼ãƒ‰ç½®ãå ´ */
        .active-spot {
            width: 110px; height: 150px; border: 2px dashed #cbd5e1; border-radius: 10px;
            display: flex; justify-content: center; align-items: center; color: #9ca3af; font-size: 0.8rem;
            transition: 0.3s;
        }
        .active-spot.filled { border: none; background: transparent; }

        /* æ‰‹æœ­ã‚¨ãƒªã‚¢ */
        .hand-area {
            height: 120px; width: 100%; overflow-x: auto; 
            display: flex; align-items: center; gap: 10px; padding: 0 20px;
            background: rgba(255,255,255,0.8); backdrop-filter: blur(10px);
            position: absolute; bottom: 0; z-index: 50;
        }
        .hand-card {
            width: 70px; height: 100px; flex-shrink: 0; 
            background: white; border: 1px solid #d1d5db; border-radius: 6px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.7rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: 0.2s;
        }
        .hand-card.selected { transform: translateY(-15px); border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary); }

        /* ã‚¨ãƒŠã‚¸ãƒ¼è¡¨ç¤º */
        .energy-pool {
            position: absolute; right: 20px; bottom: 140px;
            display: flex; flex-direction: column; gap: 5px; align-items: center;
        }
        .energy-orb {
            width: 24px; height: 24px; border-radius: 50%;
            background: #e5e7eb; border: 2px solid #d1d5db;
            display: flex; justify-content: center; align-items: center; font-size: 0.6rem;
        }
        .energy-orb.filled { background: var(--primary); border-color: var(--primary); color: white; }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚«ãƒ³ã‚¿ãƒ¼ */
        .dmg-counter {
            position: absolute; width: 30px; height: 30px; background: var(--danger);
            color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            animation: bounce 0.5s; z-index: 20; top: -10px; right: -10px;
        }
        @keyframes bounce { 0%{transform:scale(0);} 50%{transform:scale(1.2);} 100%{transform:scale(1);} }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .btn-action {
            position: absolute; bottom: 140px; left: 50%; transform: translateX(-50%);
            background: var(--text-main); color: white; padding: 10px 30px; border-radius: 20px;
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: none; z-index: 40;
        }

        /* --- ãƒ¢ãƒ¼ãƒ€ãƒ« (è©³ç´°ãƒ»ã‚¯ã‚¤ã‚º) --- */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px); z-index: 200; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        
        .card-detail-modal {
            background: white; border-radius: 20px; padding: 25px;
            width: 90%; max-width: 350px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from{transform:scale(0.8); opacity:0;} to{transform:scale(1); opacity:1;} }

        .desc-text {
            text-align: left; background: #f3f4f6; padding: 15px; border-radius: 10px;
            margin-top: 15px; font-size: 0.85rem; line-height: 1.6; color: #4b5563;
        }

        .quiz-panel {
            background: white; width: 90%; max-width: 350px; border-radius: 16px;
            padding: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .quiz-btn {
            width: 100%; padding: 12px; margin-top: 10px; border: 1px solid #e5e7eb;
            background: white; border-radius: 10px; font-weight: bold; color: var(--text-main);
        }
        .quiz-btn:active { background: #f3f4f6; }

        /* ã‚¬ãƒãƒ£æ¼”å‡º */
        .pack-wrapper {
            perspective: 1000px; cursor: pointer;
        }
        .pack {
            width: 200px; height: 300px; background: linear-gradient(135deg, #fbbf24, #d97706);
            border-radius: 15px; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
            transition: 0.5s; position: relative;
        }
        .pack:hover { transform: rotateY(10deg); }
        .pack-rip {
            position: absolute; top:0; width:100%; height:20px; background:rgba(255,255,255,0.3);
        }

    </style>
</head>
<body>

    <header class="app-header">
        <div style="font-weight:800; font-size:1.2rem;">CHEM POCKET</div>
        <div class="level-badge">Lv. 3</div>
    </header>

    <div id="screen-home" class="screen active">
        <div class="banner">
            <h2>ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³</h2>
            <p>ã‚¯ã‚¤ã‚ºã«3å•æ­£è§£ã—ã¦ãƒ‘ãƒƒã‚¯ã‚’å¼•ã“ã†ï¼</p>
            <div style="margin-top:15px; width:100%; height:6px; background:rgba(255,255,255,0.2); border-radius:3px;">
                <div style="width:60%; height:100%; background:white; border-radius:3px;"></div>
            </div>
        </div>

        <h3 style="margin: 20px 0 10px 20px;">è‡ªåˆ†ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h3>
        <div class="collection-preview" id="home-collection">
            </div>

        <div style="display:flex; flex-direction:column; align-items:center; gap:15px; margin-top:20px;">
            <button class="btn-main btn-battle" onclick="initBattle()">ã²ã¨ã‚Šã§ãƒãƒˆãƒ«</button>
            <button class="btn-main btn-open" onclick="navTo('gacha')">ãƒ‘ãƒƒã‚¯é–‹å°</button>
        </div>
    </div>

    <div id="screen-battle" class="screen" style="padding:0;">
        <div class="battle-board">
            
            <div class="zone-opponent">
                <div class="active-spot filled" id="enemy-spot">
                    <div class="card-frame rarity-2">
                        <div class="card-inner">
                            <div class="c-header"><span>HP 200</span><span class="c-hp">â–¼</span></div>
                            <div class="c-image">ğŸ‘¹</div>
                            <div class="c-name">æ¿ƒç¡«é…¸</div>
                            <div class="c-skill">è„±æ°´ä½œç”¨<br>æœ‰æ©Ÿç‰©ã«å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸</div>
                        </div>
                    </div>
                    <div id="enemy-dmg" class="dmg-counter" style="display:none;">-30</div>
                </div>
            </div>

            <div class="zone-player">
                <div class="active-spot" id="player-spot">
                    CARD SLOT
                </div>
                
                <button id="atk-btn" class="btn-action" onclick="attackAction()">æ”»æ’ƒã™ã‚‹</button>

                <div class="energy-pool" id="energy-pool">
                    <div class="energy-orb"></div>
                    <div class="energy-orb"></div>
                    <div class="energy-orb"></div>
                </div>
            </div>

            <div class="hand-area" id="hand-container">
                </div>
        </div>
    </div>

    <div id="screen-gacha" class="screen" style="justify-content:center; align-items:center;">
        <h2 style="color:var(--text-sub);">æ–°ã—ã„ç‰©è³ªã‚’ç™ºè¦‹</h2>
        <div class="pack-wrapper" onclick="openPack()">
            <div class="pack">
                <div class="pack-rip"></div>
                <div style="font-size:3rem; color:white; font-weight:900;">CHEM</div>
            </div>
        </div>
        <p style="margin-top:30px; font-size:0.8rem; color:var(--text-sub);">ã‚¿ãƒƒãƒ—ã—ã¦é–‹å°</p>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home')">
            <div class="nav-icon">ğŸ </div><span>ãƒ›ãƒ¼ãƒ </span>
        </div>
        <div class="nav-item" onclick="navTo('gacha')">
            <div class="nav-icon">ğŸ´</div><span>ãƒ‘ãƒƒã‚¯</span>
        </div>
        <div class="nav-item" onclick="alert('å¯¾æˆ¦æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™')">
            <div class="nav-icon">âš”ï¸</div><span>å¯¾æˆ¦</span>
        </div>
    </nav>

    <div id="detail-modal" class="modal-overlay" onclick="closeModal('detail-modal')">
        <div class="card-detail-modal" onclick="event.stopPropagation()">
            <div id="detail-card-view" style="display:flex; justify-content:center;"></div>
            <div class="desc-text">
                <h4>å­¦ç¿’ãƒ¡ãƒ¢</h4>
                <p id="detail-desc">ã“ã“ã«åŒ–å­¦çš„ãªè§£èª¬ãŒå…¥ã‚Šã¾ã™ã€‚</p>
            </div>
            <button class="btn-main" style="margin-top:15px; width:100%; padding:10px;" onclick="closeModal('detail-modal')">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div id="quiz-modal" class="modal-overlay">
        <div class="quiz-panel">
            <div style="font-size:0.8rem; color:var(--primary); font-weight:bold; margin-bottom:10px;">ã‚¨ãƒŠã‚¸ãƒ¼ãƒã‚§ãƒƒã‚¯</div>
            <h3 id="q-text" style="margin-bottom:20px;">å•é¡Œæ–‡</h3>
            <div id="q-options"></div>
        </div>
    </div>

    <div id="result-modal" class="modal-overlay">
        <div class="card-detail-modal">
            <h2 style="color:var(--primary);">å‹åˆ©ï¼</h2>
            <div style="font-size:3rem;">ğŸ†</div>
            <p>çµŒé¨“å€¤ã‚’ç²å¾—ã—ã¾ã—ãŸ</p>
            <button class="btn-main" onclick="navTo('home')">ãƒ›ãƒ¼ãƒ ã¸</button>
        </div>
    </div>

    <script>
        // --- 1. ãƒ‡ãƒ¼ã‚¿ (å­¦ç¿’å†…å®¹ã‚’å«ã‚€) ---
        const cards = [
            {id:1, name:"æ°´ç´ ", hp:60, atk:30, cost:1, rarity:1, img:"Hâ‚‚", desc:"æœ€ã‚‚è»½ã„å…ƒç´ ã€‚é…¸ç´ ã¨åå¿œã—ã¦çˆ†ç™ºçš„ã«ç‡ƒç„¼ã—ã€æ°´ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆçˆ†é³´æ°—ï¼‰ã€‚ç‡ƒæ–™é›»æ± ã«ã‚‚åˆ©ç”¨ã•ã‚Œã‚‹ã€‚"},
            {id:2, name:"é»’é‰›", hp:70, atk:20, cost:1, rarity:1, img:"C", desc:"ç‚­ç´ ã®åŒç´ ä½“ã®ä¸€ã¤ã€‚å±¤çŠ¶æ§‹é€ ã‚’æŒã¡ã€æŸ”ã‚‰ã‹ãé›»æ°—ã‚’é€šã™ã€‚é‰›ç­†ã®èŠ¯ã‚„é›»æ¥µã«ä½¿ã‚ã‚Œã‚‹ã€‚"},
            {id:3, name:"å¡©é…¸", hp:50, atk:50, cost:2, rarity:2, img:"HCl", desc:"å¡©åŒ–æ°´ç´ ã®æ°´æº¶æ¶²ã€‚èƒƒæ¶²ã«å«ã¾ã‚Œã‚‹å¼·é…¸ã€‚é‡‘å±ã‚’æº¶ã‹ã—ã¦æ°´ç´ ã‚’ç™ºç”Ÿã•ã›ã‚‹ã€‚ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ã¨åå¿œã—ã¦ç™½ç…™ã‚’ç”Ÿã˜ã‚‹ã€‚"},
            {id:4, name:"ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢", hp:60, atk:40, cost:2, rarity:2, img:"NHâ‚ƒ", desc:"åˆºæ¿€è‡­ã®ã‚ã‚‹æ°—ä½“ã€‚æ°´ã«éå¸¸ã«ã‚ˆãæº¶ã‘ã€ãã®æ°´æº¶æ¶²ã¯å¡©åŸºæ€§ã‚’ç¤ºã™ï¼ˆå™´æ°´å®Ÿé¨“ï¼‰ã€‚è‚¥æ–™ã®åŸæ–™ã¨ã—ã¦é‡è¦ã€‚"},
            {id:5, name:"ãƒ™ãƒ³ã‚¼ãƒ³", hp:80, atk:70, cost:3, rarity:3, img:"Câ‚†Hâ‚†", desc:"èŠ³é¦™æ—ç‚­åŒ–æ°´ç´ ã®ä»£è¡¨ã€‚æ­£å…­è§’å½¢ã®å¹³é¢æ§‹é€ ã‚’æŒã¡ã€å…±é³´ã«ã‚ˆã‚Šéå¸¸ã«å®‰å®šã—ã¦ã„ã‚‹ã€‚ç½®æ›åå¿œã‚’èµ·ã“ã—ã‚„ã™ã„ã€‚"},
            {id:6, name:"ç‹æ°´", hp:40, atk:90, cost:3, rarity:3, img:"Auæº¶", desc:"æ¿ƒå¡©é…¸ã¨æ¿ƒç¡é…¸ã‚’3:1ã®ä½“ç©æ¯”ã§æ··åˆã—ãŸæ¶²ä½“ã€‚é…¸åŒ–åŠ›ãŒæ¥µã‚ã¦å¼·ãã€é‡‘ã‚„ç™½é‡‘ãªã©ã®è²´é‡‘å±ã‚‚æº¶ã‹ã™ã“ã¨ãŒã§ãã‚‹ã€‚"}
        ];

        const quizList = [
            {q:"ã€Œç‹æ°´ã€ã‚’ä½œã‚‹æ™‚ã®å¡©é…¸ã¨ç¡é…¸ã®å‰²åˆã¯ï¼Ÿ", a:0, o:["å¡©é…¸3 : ç¡é…¸1", "å¡©é…¸1 : ç¡é…¸3", "å¡©é…¸1 : ç¡é…¸1"]},
            {q:"ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ã®æ€§è³ªã¨ã—ã¦æ­£ã—ã„ã®ã¯ï¼Ÿ", a:1, o:["æ°´ã«æº¶ã‘ã«ãã„", "æ°´ã«ã‚ˆãæº¶ã‘å¡©åŸºæ€§ã‚’ç¤ºã™", "ç©ºæ°—ã‚ˆã‚Šé‡ã„"]},
            {q:"ãƒ™ãƒ³ã‚¼ãƒ³ã®æ§‹é€ ã®ç‰¹å¾´ã¯ï¼Ÿ", a:2, o:["æ­£å››é¢ä½“", "ç›´ç·šå½¢", "æ­£å…­è§’å½¢"]},
            {q:"æ¬¡ã®ä¸­ã§é›»æ°—ã‚’é€šã™ç‰©è³ªã¯ï¼Ÿ", a:0, o:["é»’é‰›", "ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰", "ç¡«é»„"]}
        ];

        // --- 2. å¤‰æ•° ---
        let myCollection = [cards[0], cards[1], cards[2]];
        let energy = 0;
        let selectedCard = null;
        let enemyHp = 200;

        // --- 3. åˆæœŸåŒ– ---
        window.onload = () => {
            updateCollection();
        };

        function navTo(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-'+screenId).classList.add('active');
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(screenId === 'home') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if(screenId === 'gacha') document.querySelectorAll('.nav-item')[1].classList.add('active');
            
            // ç”»é¢ã”ã¨ã®åˆæœŸåŒ–
            if(screenId === 'home') updateCollection();
            document.getElementById('result-modal').style.display = 'none';
        }

        // --- 4. ãƒ›ãƒ¼ãƒ ç”»é¢ ---
        function updateCollection() {
            const container = document.getElementById('home-collection');
            container.innerHTML = "";
            myCollection.forEach(c => {
                const el = createCardElement(c);
                el.onclick = () => showCardDetail(c); // ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°
                el.style.flexShrink = "0";
                container.appendChild(el);
            });
        }

        // --- 5. ãƒãƒˆãƒ«ã‚·ã‚¹ãƒ†ãƒ  (ã‚¯ã‚¤ã‚ºé€£æº) ---
        function initBattle() {
            navTo('battle');
            energy = 0;
            enemyHp = 200;
            selectedCard = null;
            updateEnergyDisplay();
            document.getElementById('enemy-dmg').style.display = 'none';
            document.getElementById('atk-btn').style.display = 'none';
            document.getElementById('player-spot').innerHTML = `<span style="color:#cbd5e1; font-size:0.8rem;">ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ</span>`;
            document.getElementById('player-spot').className = "active-spot";
            
            renderHand();
            
            // é–‹å¹•ã‚¯ã‚¤ã‚º
            setTimeout(startQuizTurn, 500);
        }

        function renderHand() {
            const container = document.getElementById('hand-container');
            container.innerHTML = "";
            myCollection.forEach(c => {
                const div = document.createElement('div');
                div.className = 'hand-card';
                div.innerHTML = `<div>${c.img}</div><div style="font-weight:bold;">${c.name}</div><div style="color:${c.cost>energy?'#ccc':'#3b82f6'}">${c.cost}âš¡</div>`;
                div.onclick = () => selectBattleCard(c, div);
                container.appendChild(div);
            });
        }

        function selectBattleCard(c, div) {
            if(c.cost > energy) return; // ã‚¨ãƒŠã‚¸ãƒ¼ä¸è¶³
            
            document.querySelectorAll('.hand-card').forEach(d => d.classList.remove('selected'));
            div.classList.add('selected');
            selectedCard = c;
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚»ãƒƒãƒˆ
            const spot = document.getElementById('player-spot');
            spot.innerHTML = "";
            spot.className = "active-spot filled";
            spot.appendChild(createCardElement(c));
            
            document.getElementById('atk-btn').style.display = 'block';
        }

        function attackAction() {
            // ã‚³ã‚¹ãƒˆæ¶ˆè²»
            energy -= selectedCard.cost;
            updateEnergyDisplay();
            document.getElementById('atk-btn').style.display = 'none';
            
            // æ”»æ’ƒæ¼”å‡º
            const playerCardEl = document.querySelector('#player-spot .card-frame');
            playerCardEl.style.transform = "translateY(-50px) scale(1.1)";
            
            setTimeout(() => {
                const dmg = selectedCard.atk;
                enemyHp -= dmg;
                
                // ãƒ€ãƒ¡ãƒ¼ã‚¸è¡¨ç¤º
                const badge = document.getElementById('enemy-dmg');
                badge.innerText = "-" + dmg;
                badge.style.display = 'flex';
                
                // æ•µæºã‚Œã‚‹
                const enemy = document.querySelector('.rarity-2'); // æ•µã‚«ãƒ¼ãƒ‰
                enemy.style.transform = "translateX(5px)";
                setTimeout(()=>enemy.style.transform = "translateX(0)", 100);

                if(enemyHp <= 0) {
                    setTimeout(() => document.getElementById('result-modal').style.display = 'flex', 1000);
                } else {
                    // æ¬¡ã®ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¯ã‚¤ã‚ºï¼‰ã¸
                    playerCardEl.style.transform = "translateY(0)";
                    setTimeout(() => {
                        badge.style.display = 'none';
                        startQuizTurn();
                    }, 1500);
                }
            }, 300);
        }

        // --- ã‚¯ã‚¤ã‚ºãƒ­ã‚¸ãƒƒã‚¯ ---
        function startQuizTurn() {
            const q = quizList[Math.floor(Math.random() * quizList.length)];
            document.getElementById('q-text').innerText = q.q;
            const opts = document.getElementById('q-options');
            opts.innerHTML = "";
            q.o.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = "quiz-btn"; b.innerText = txt;
                b.onclick = () => {
                    document.getElementById('quiz-modal').style.display = 'none';
                    if(i === q.a) {
                        energy += 2; // æ­£è§£ã§+2
                        alert("æ­£è§£ï¼ ã‚¨ãƒŠã‚¸ãƒ¼+2");
                    } else {
                        energy += 1; // ä¸æ­£è§£ã§ã‚‚+1 (è©°ã¿é˜²æ­¢)
                        alert("ä¸æ­£è§£... (ã‚¨ãƒŠã‚¸ãƒ¼+1)");
                    }
                    updateEnergyDisplay();
                    renderHand(); // ã‚³ã‚¹ãƒˆå†è¨ˆç®—ã®ãŸã‚å†æç”»
                };
                opts.appendChild(b);
            });
            document.getElementById('quiz-modal').style.display = 'flex';
        }

        function updateEnergyDisplay() {
            const orbs = document.querySelectorAll('.energy-orb');
            orbs.forEach((o, i) => {
                if(i < energy) o.classList.add('filled');
                else o.classList.remove('filled');
            });
        }

        // --- è©³ç´°è¡¨ç¤º (å›³é‘‘æ©Ÿèƒ½) ---
        function showCardDetail(c) {
            const view = document.getElementById('detail-card-view');
            view.innerHTML = "";
            const el = createCardElement(c);
            el.className = "card-frame rarity-" + c.rarity + " card-detail-view";
            view.appendChild(el);
            
            document.getElementById('detail-desc').innerText = c.desc;
            document.getElementById('detail-modal').style.display = 'flex';
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- ã‚¬ãƒãƒ£ ---
        function openPack() {
            // ç°¡æ˜“æ¼”å‡º
            const pack = document.querySelector('.pack');
            pack.style.transform = "scale(1.1)";
            setTimeout(() => {
                const r = Math.random();
                let rarity = 1; if(r<0.2) rarity=3; else if(r<0.5) rarity=2;
                const hit = cards.filter(c=>c.rarity===rarity)[0];
                myCollection.push(hit);
                
                showCardDetail(hit); // è©³ç´°ç”»é¢ã‚’ä½¿ã£ã¦çµæœè¡¨ç¤º
                pack.style.transform = "scale(1)";
            }, 500);
        }

        // --- HTMLç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
        function createCardElement(c) {
            const div = document.createElement('div');
            div.className = `card-frame rarity-${c.rarity}`;
            div.innerHTML = `
                <div class="card-inner">
                    <div class="c-header">
                        <span>${c.name}</span><span class="c-hp">${c.hp}</span>
                    </div>
                    <div class="c-image">${c.img}</div>
                    <div class="c-name">${c.name}</div>
                    <div class="c-skill">Atk:${c.atk} / Cost:${c.cost}âš¡</div>
                </div>
            `;
            return div;
        }

    </script>
</body>
</html>