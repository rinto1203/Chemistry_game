<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COSMIC CHEMISTRY V2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Zen+Dots&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-blue: #0066ff;
            --neon-pink: #ff0055;
            --neon-gold: #ffd700;
            --neon-green: #00ff9d;
            --bg-dark: #050b14;
            --font-main: 'Rajdhani', sans-serif;
            --font-jp: 'Zen Dots', sans-serif;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 50% 120%, #1a0b2e 0%, #000000 70%),
                radial-gradient(circle at 20% 20%, rgba(0, 243, 255, 0.1) 0%, transparent 40%);
            font-family: var(--font-main);
            color: #fff;
            height: 100dvh; width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- 3D & „Éõ„É≠„Ç∞„É©„É†Áî®„Çπ„Çø„Ç§„É´ --- */
        .card-scene {
            perspective: 1000px;
            width: 140px; height: 200px;
            position: relative;
            transition: transform 0.3s;
        }

        .card-frame {
            width: 100%; height: 100%;
            position: relative;
            background: rgba(10, 15, 25, 0.95);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            /* „ÉÜ„ÉÉ„ÇØÈ¢®„ÇØ„É™„ÉÉ„Éó */
            clip-path: polygon(
                0 15px, 15px 0, 100% 0, 100% calc(100% - 15px), 
                calc(100% - 15px) 100%, 0 100%
            );
            display: flex; flex-direction: column; padding: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.1s ease-out; /* „Éû„Ç¶„ÇπËøΩÂæìÁî® */
            transform-style: preserve-3d;
            overflow: hidden;
        }

        /* „Ç≠„É©„Ç≠„É©ÂèçÂ∞Ñ„É¨„Ç§„É§„Éº */
        .card-shine {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(
                125deg, 
                transparent 0%, 
                rgba(255,255,255,0) 40%, 
                rgba(255,255,255,0.4) 47%, 
                rgba(255,255,255,0) 54%, 
                transparent 100%
            );
            opacity: 0; mix-blend-mode: overlay; pointer-events: none; z-index: 10;
            transition: opacity 0.3s;
            transform: translateZ(1px);
        }
        
        /* „É¨„Ç¢Â∫¶„ÅåÈ´ò„ÅÑ„Å®„Åç„ÅÆËôπËâ≤„Éõ„É≠„Ç∞„É©„É† */
        .rarity-3 .card-shine {
            background: linear-gradient(
                125deg, 
                transparent 20%, 
                rgba(255,0,0,0.4) 40%, 
                rgba(0,255,0,0.4) 50%, 
                rgba(0,0,255,0.4) 60%, 
                transparent 80%
            );
            mix-blend-mode: color-dodge;
        }

        .card-frame:hover .card-shine { opacity: 1; }

        /* „É¨„Ç¢„É™„ÉÜ„Ç£Êû†Ëâ≤ */
        .rarity-1 { border-color: #555; }
        .rarity-2 { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }
        .rarity-3 { border-color: var(--neon-gold); box-shadow: 0 0 25px rgba(255, 215, 0, 0.4); }

        .card-art {
            flex: 1; background: #000; margin: 4px; position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1); 
            display: flex; justify-content: center; align-items: center;
        }
        .card-art img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; pointer-events: none; }
        
        .card-info { padding: 5px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); position:absolute; bottom:0; width:100%; }
        .card-name { font-size: 0.75rem; color: #fff; font-weight: bold; text-shadow:0 0 5px var(--neon-cyan); }
        .card-effect { font-size: 0.6rem; color: #aaa; margin-top:2px; line-height:1.1; display: block; } /* ÂäπÊûú„ÉÜ„Ç≠„Çπ„ÉàËøΩÂä† */
        
        .cost-badge {
            position: absolute; top: 5px; left: 5px; width: 26px; height: 26px;
            background: var(--neon-blue); clip-path: polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%);
            display: flex; justify-content: center; align-items: center; 
            font-weight: 900; color: #fff; z-index: 5; font-size: 1rem;
        }

        /* --- ÊâãÊú≠„Ç®„É™„Ç¢„ÅÆÊîπ‰øÆ --- */
        .hand-area {
            position: absolute; bottom: 20px; width: 100%; height: 220px;
            display: flex; justify-content: center; align-items: flex-end;
            perspective: 1200px; padding-bottom: 20px;
            pointer-events: none; /* „Ç®„É™„Ç¢Ëá™‰Ωì„ÅØ„ÇØ„É™„ÉÉ„ÇØÈÄèÈÅé */
        }
        .hand-card-wrap {
            width: 120px; height: 170px; margin: 0 -30px;
            transition: 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center bottom;
            pointer-events: auto; /* „Ç´„Éº„Éâ„ÅØ„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ */
            position: relative;
            cursor: pointer;
        }
        .hand-card-wrap:hover {
            transform: translateY(-80px) scale(1.3) rotate(0deg) !important;
            z-index: 100; margin: 0 40px;
        }
        .hand-card-wrap .card-frame { pointer-events: none; } /* JS„ÅßË¶™„Çí„ÇØ„É™„ÉÉ„ÇØÂà§ÂÆö„Åô„Çã„Åü„ÇÅ */

        /* --- UIÂÖ±ÈÄö --- */
        .stars { position: fixed; inset:0; pointer-events:none; z-index:0; opacity:0.5; background: radial-gradient(white 1px, transparent 1px) 0 0 / 50px 50px; }
        .screen { position: absolute; inset:0; display: none; flex-direction: column; z-index: 10; opacity: 0; transition: opacity 0.5s; background: rgba(0,0,0,0.6); }
        .screen.active { display: flex; opacity: 1; }

        .hud-top {
            height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); z-index: 100;
        }
        .cyber-btn {
            background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-cyan); color: var(--neon-cyan);
            padding: 12px 30px; font-weight: bold; letter-spacing: 2px; cursor: pointer; text-align: center;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            transition: 0.3s;
            text-transform: uppercase;
        }
        .cyber-btn:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 20px var(--neon-cyan); }

        /* --- „Éê„Éà„É´„Éï„Ç£„Éº„É´„Éâ --- */
        .battle-stage { flex: 1; display: flex; flex-direction: column; perspective: 1200px; overflow: hidden; }
        
        .enemy-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .player-zone { height: 300px; display: flex; flex-direction: column; justify-content: flex-end; position: relative; }

        /* „Éú„ÇπÊºîÂá∫ */
        .boss-unit {
            width: 160px; height: 160px; position: relative;
            display: flex; justify-content: center; align-items: center;
        }
        .boss-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 0 20px var(--neon-pink)); animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }

        /* „Ç≥„É≥„ÉúË°®Á§∫ */
        .combo-text {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0);
            font-family: var(--font-jp); font-size: 3rem; color: var(--neon-gold);
            text-shadow: 0 0 20px var(--neon-pink); pointer-events: none; z-index: 2000;
            white-space: nowrap;
        }
        .combo-anim { animation: comboPop 1.5s forwards; }
        @keyframes comboPop { 0%{transform:translate(-50%,-50%) scale(0.5); opacity:0;} 20%{transform:translate(-50%,-50%) scale(1.2); opacity:1;} 80%{opacity:1;} 100%{transform:translate(-50%,-100px) scale(1.5); opacity:0;} }

        /* „ÉÄ„É°„Éº„Ç∏„Å™„Å©„ÅÆ„Éï„É©„Ç§„ÉÜ„Ç≠„Çπ„Éà */
        .fly-text {
            position: absolute; font-size: 2rem; font-weight: 900; pointer-events: none; z-index: 1000;
            animation: flyUp 1s forwards; text-shadow: 0 0 5px #000;
        }
        @keyframes flyUp { 0%{transform:translate(-50%,0);} 100%{transform:translate(-50%,-80px); opacity:0;} }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº */
        .bar-container { width: 200px; height: 10px; background: #333; border: 1px solid #555; transform: skewX(-20deg); margin: 5px; position:relative; }
        .bar-fill { height: 100%; background: var(--neon-green); width: 100%; transition: width 0.3s; box-shadow: 0 0 10px var(--neon-green); }
        .bar-fill.enemy { background: var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink); }
        
        /* „Ç§„É≥„ÉÜ„É≥„ÉàÔºàÊïµ„ÅÆË°åÂãï‰∫àÂëäÔºâ */
        .intent-badge {
            position: absolute; top: -30px; background: rgba(0,0,0,0.8); border: 1px solid #fff;
            padding: 2px 10px; border-radius: 4px; color: #fff; font-size: 0.8rem;
        }

    </style>
</head>
<body>

    <div class="stars"></div>

    <header class="hud-top">
        <div style="font-size:1.5rem; font-weight:900; letter-spacing:2px;">COSMIC<span style="color:var(--neon-cyan)">.CHEM</span> V2</div>
        <div style="display:flex; gap:15px; font-weight:bold;">
            <div style="color:var(--neon-gold)">‚ö° <span id="energy-val">0</span></div>
        </div>
    </header>

    <div id="screen-login" class="screen active" style="justify-content:center; align-items:center;">
        <h1 style="font-size:4rem; margin:0; line-height:0.9; text-align:center; text-shadow:0 0 30px var(--neon-cyan); font-family:var(--font-jp);">
            ÂÆáÂÆô<br><span style="color:var(--neon-cyan)">ÂåñÂ≠¶</span>
        </h1>
        <p style="color:#aaa; letter-spacing:5px; margin-bottom:60px;">TACTICAL REACTION BATTLE</p>
        <div class="cyber-btn" onclick="startGame()">SYSTEM BOOT</div>
    </div>

    <div id="screen-battle" class="screen">
        <div class="battle-stage">
            
            <div class="enemy-zone">
                <div class="boss-unit" id="enemy-unit">
                    <div class="intent-badge" id="enemy-intent">‚ö† CHARGING</div>
                    <img src="https://placehold.co/200x200/220000/ff0055?text=DARK+MATTER&font=roboto" class="boss-img" id="enemy-img">
                </div>
                <div style="margin-top:10px;">
                    <div style="text-align:center; font-weight:bold;" id="enemy-name">ANOMALY: UNKNOWN</div>
                    <div class="bar-container"><div id="enemy-hp-bar" class="bar-fill enemy"></div></div>
                    <div style="text-align:right; font-size:0.8rem;">HP: <span id="enemy-hp-text">500</span></div>
                </div>
            </div>

            <div id="combo-display" class="combo-text">REACTION!</div>

            <div class="player-zone">
                <div style="display:flex; justify-content:space-between; padding:10px 20px; align-items:flex-end; z-index:20;">
                    <div>
                        <div style="font-size:0.8rem; color:#aaa;">SHIELD STATUS</div>
                        <div class="bar-container"><div id="player-hp-bar" class="bar-fill"></div></div>
                        <div style="font-size:0.8rem;">HP: <span id="player-hp-text">200</span></div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:0.8rem; color:#aaa;">ELECTRON VALENCE (MANA)</div>
                        <div style="display:flex; gap:5px;" id="mana-box"></div>
                    </div>
                </div>

                <div style="position:absolute; top:-50px; left:50%; transform:translateX(-50%); width:100px; height:140px; border:2px dashed rgba(0,243,255,0.3); border-radius:10px; display:flex; justify-content:center; align-items:center; z-index:10;" id="field-slot">
                    <span style="font-size:0.7rem; color:#666;">FIELD</span>
                </div>

                <div class="hand-area" id="hand-container"></div>
                
                <button id="turn-btn" class="cyber-btn" style="position:absolute; bottom:250px; right:20px; z-index:200; display:none;" onclick="endTurn()">END TURN</button>
            </div>
        </div>
    </div>

    <div id="quiz-modal" class="screen" style="background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000;">
        <div style="background:#0a0f19; border:2px solid var(--neon-cyan); padding:30px; width:90%; max-width:500px; position:relative;">
            <h2 style="color:var(--neon-cyan); margin-top:0;">ELECTRON RECHARGE</h2>
            <p id="quiz-q" style="font-size:1.2rem; font-weight:bold; min-height:60px;">Question...</p>
            <div id="quiz-opts" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
    </div>

    <script>
        // --- 1. „Ç´„Éº„Éâ„Éá„Éº„Çø (ÂåñÂ≠¶Â±ûÊÄß„ÇíËøΩÂä†) ---
        // type: ATK(ÊîªÊíÉ), DEF(Èò≤Âæ°), SUP(Ë£úÂä©)
        // element: ÂåñÂ≠¶ÂèçÂøúÂà§ÂÆöÁî® (H, O, Cl, Na, etc.)
        const CARDS_DB = [
            {id:1, name:"Ê∞¥Á¥† (H‚ÇÇ)", cost:1, val:15, type:"ATK", element:"H", rarity:1, desc:"ÊúÄ„ÇÇËªΩ„ÅÑÂÖÉÁ¥†„ÄÇÂèØÁáÉÊÄß„ÄÇ", img:"H"},
            {id:2, name:"ÈÖ∏Á¥† (O‚ÇÇ)", cost:1, val:10, type:"SUP", element:"O", rarity:1, desc:"ÁáÉÁÑº„ÇíÂä©„Åë„Çã„ÄÇÂèçÂøúÊÄß„ÅåÈ´ò„ÅÑ„ÄÇ", img:"O"},
            {id:3, name:"„Éä„Éà„É™„Ç¶„É† (Na)", cost:2, val:25, type:"ATK", element:"Na", rarity:2, desc:"Ê∞¥„Å®ÊøÄ„Åó„ÅèÂèçÂøú„Åô„ÇãÈáëÂ±û„ÄÇ", img:"Na"},
            {id:4, name:"Â°©Á¥† (Cl‚ÇÇ)", cost:2, val:30, type:"ATK", element:"Cl", rarity:2, desc:"Âº∑„ÅÑÊØíÊÄß„ÇíÊåÅ„Å§Ê∞ó‰Ωì„ÄÇ", img:"Cl"},
            {id:5, name:"Ê∞¥ (H‚ÇÇO)", cost:2, val:20, type:"HEAL", element:"H2O", rarity:1, desc:"ÁîüÂëΩ„ÅÆÊ∫ê„ÄÇ‰∏≠ÊÄß„ÄÇ", img:"H2O"},
            {id:6, name:"Ê∞¥ÈÖ∏ÂåñNa (NaOH)", cost:3, val:40, type:"DEF", element:"Base", rarity:2, desc:"Âº∑Â°©Âü∫„ÄÇ„Çø„É≥„Éë„ÇØË≥™„ÇíÊ∫∂„Åã„Åô„ÄÇ", img:"NaOH"},
            {id:7, name:"Â°©ÈÖ∏ (HCl)", cost:3, val:45, type:"ATK", element:"Acid", rarity:3, desc:"Âº∑ÈÖ∏„ÄÇÈáëÂ±û„ÇíÊ∫∂„Åã„Åô„ÄÇ", img:"HCl"},
            {id:8, name:"Â∏å„Ç¨„Çπ (He)", cost:2, val:50, type:"DEF", element:"Noble", rarity:3, desc:"ÂèçÂøú„Åó„Å™„ÅÑ„ÄÇÂÆåÂÖ®Èò≤Âæ°„ÄÇ", img:"He"}
        ];

        const QUIZ_DB = [
            {q:"ÂéüÂ≠êÊ†∏„ÅÆÂë®„Çä„ÇíÂõû„Å£„Å¶„ÅÑ„Çã„Éû„Ç§„Éä„Çπ„ÅÆÈõªÊ∞ó„ÇíÂ∏Ø„Å≥„ÅüÁ≤íÂ≠ê„ÅØÔºü", a:0, o:["ÈõªÂ≠ê","ÈôΩÂ≠ê","‰∏≠ÊÄßÂ≠ê"]},
            {q:"pH„Åå7„Çà„ÇäÂ∞è„Åï„ÅÑÊ∞¥Ê∫∂Ê∂≤„ÅÆÊÄßË≥™„ÅØÔºü", a:1, o:["„Ç¢„É´„Ç´„É™ÊÄß","ÈÖ∏ÊÄß","‰∏≠ÊÄß"]},
            {q:"ÁÇéËâ≤ÂèçÂøú„Åß„ÄåËµ§Ëâ≤„Äç„ÇíÁ§∫„ÅôÈáëÂ±ûÂÖÉÁ¥†„ÅØÔºü", a:2, o:["Cu (ÈäÖ)","Na („Éä„Éà„É™„Ç¶„É†)","Li („É™„ÉÅ„Ç¶„É†)"]},
            {q:"ÂéüÂ≠êÁï™Âè∑1Áï™„ÅÆÂÖÉÁ¥†„ÅØÔºü", a:0, o:["Ê∞¥Á¥†","„Éò„É™„Ç¶„É†","ÁÇ≠Á¥†"]}
        ];

        // --- 2. „Ç≤„Éº„É†Áä∂ÊÖãÁÆ°ÁêÜ ---
        let gameState = {
            playerHp: 200, playerMaxHp: 200,
            enemyHp: 500, enemyMaxHp: 500,
            mana: 0, maxMana: 5,
            hand: [],
            fieldCard: null, // Â†¥„Å´Âá∫„Å¶„ÅÑ„ÇãÁõ¥Ââç„ÅÆ„Ç´„Éº„ÉâÔºà„Ç≥„É≥„ÉúÁî®Ôºâ
            turn: 0,
            enemyIntent: "attack"
        };

        // --- 3. „Ç≤„Éº„É†„É´„Éº„Éó & UI ---
        function startGame() {
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.getElementById('screen-battle').classList.add('active');
            
            // ÂàùÊúü„Éá„ÉÉ„Ç≠ („É©„É≥„ÉÄ„É†5Êûö)
            for(let i=0; i<5; i++) drawCard();
            
            updateUI();
            startTurn();
        }

        function startTurn() {
            // „Çø„Éº„É≥ÈñãÂßãÊôÇ„Å´„ÇØ„Ç§„Ç∫„Åß„Éû„ÉäÂõûÂæ©
            showQuiz();
        }

        function showQuiz() {
            const q = QUIZ_DB[Math.floor(Math.random()*QUIZ_DB.length)];
            document.getElementById('quiz-q').innerText = q.q;
            const opts = document.getElementById('quiz-opts'); opts.innerHTML = "";
            
            q.o.forEach((txt, idx) => {
                const b = document.createElement('div');
                b.className = "cyber-btn";
                b.innerText = txt;
                b.onclick = () => {
                    document.getElementById('quiz-modal').classList.remove('active');
                    if(idx === q.a) {
                        gameState.mana = Math.min(gameState.maxMana, gameState.mana + 3);
                        showFlyText("PERFECT! +3e‚Åª", "#00f3ff", window.innerWidth/2, window.innerHeight/2);
                    } else {
                        gameState.mana = Math.min(gameState.maxMana, gameState.mana + 1);
                        showFlyText("STABLE... +1e‚Åª", "#aaa", window.innerWidth/2, window.innerHeight/2);
                    }
                    updateUI();
                    
                    // Êïµ„ÅÆË°åÂãïÊ±∫ÂÆö
                    decideEnemyIntent();
                };
                opts.appendChild(b);
            });
            document.getElementById('quiz-modal').classList.add('active');
        }

        function drawCard() {
            const c = CARDS_DB[Math.floor(Math.random()*CARDS_DB.length)];
            gameState.hand.push({...c, uid: Math.random()}); // „É¶„Éã„Éº„ÇØID‰ªò‰∏é
        }

        function updateUI() {
            // HP Bars
            const pPct = (gameState.playerHp/gameState.playerMaxHp)*100;
            const ePct = (gameState.enemyHp/gameState.enemyMaxHp)*100;
            document.getElementById('player-hp-bar').style.width = pPct+"%";
            document.getElementById('player-hp-text').innerText = gameState.playerHp;
            document.getElementById('enemy-hp-bar').style.width = ePct+"%";
            document.getElementById('enemy-hp-text').innerText = gameState.enemyHp;

            // Mana
            const mBox = document.getElementById('mana-box'); mBox.innerHTML="";
            for(let i=0; i<gameState.maxMana; i++){
                const d = document.createElement('div');
                d.style.width="15px"; d.style.height="20px"; 
                d.style.background = (i < gameState.mana) ? "var(--neon-cyan)" : "#333";
                d.style.border = "1px solid var(--neon-cyan)";
                d.style.transform = "skewX(-20deg)";
                if(i < gameState.mana) d.style.boxShadow = "0 0 10px var(--neon-cyan)";
                mBox.appendChild(d);
            }

            // Hand
            renderHand();

            // Field
            const slot = document.getElementById('field-slot');
            if(gameState.fieldCard) {
                // Á∞°ÊòìË°®Á§∫
                slot.innerHTML = `<div style="font-weight:bold; color:var(--neon-cyan);">${gameState.fieldCard.name}</div>`;
                slot.style.borderColor = "var(--neon-cyan)";
                slot.style.boxShadow = "0 0 20px rgba(0,243,255,0.2)";
            } else {
                slot.innerHTML = `<span style="font-size:0.7rem; color:#666;">FIELD</span>`;
                slot.style.borderColor = "#444";
                slot.style.boxShadow = "none";
            }
        }

        // --- 4. 3D„Ç´„Éº„ÉâÊèèÁîª„Ç∑„Çπ„ÉÜ„É† ---
        function renderHand() {
            const container = document.getElementById('hand-container');
            container.innerHTML = "";
            
            const count = gameState.hand.length;
            
            gameState.hand.forEach((card, i) => {
                const wrap = document.createElement('div');
                wrap.className = "hand-card-wrap";
                
                // ÊâáÁä∂„Å´ÈÖçÁΩÆ
                const rot = (i - (count-1)/2) * 5; 
                const y = Math.abs(i - (count-1)/2) * 10;
                wrap.style.transform = `rotate(${rot}deg) translateY(${y}px)`;
                
                // HTMLÁîüÊàê
                let color = "var(--neon-cyan)";
                if(card.type==="ATK") color="var(--neon-pink)";
                if(card.type==="DEF") color="var(--neon-green)";
                if(card.type==="HEAL") color="var(--neon-gold)";

                const imgUrl = `https://placehold.co/120x100/000/FFF?text=${card.img}&font=roboto`;

                wrap.innerHTML = `
                    <div class="card-scene">
                        <div class="card-frame rarity-${card.rarity}" style="border-color:${color}">
                            <div class="card-shine"></div>
                            <div class="cost-badge" style="background:${color}">${card.cost}</div>
                            <div class="card-art">
                                <img src="${imgUrl}" alt="${card.name}">
                            </div>
                            <div class="card-info">
                                <div class="card-name" style="color:${color}">${card.name}</div>
                                <div class="card-effect">${card.type} | POW ${card.val}</div>
                                <div style="font-size:0.55rem; color:#ccc; margin-top:2px;">${card.desc}</div>
                            </div>
                        </div>
                    </div>
                `;

                // „Éû„Éä‰∏çË∂≥„Å™„ÇâÊöó„Åè„Åô„Çã
                if(card.cost > gameState.mana) {
                    wrap.style.filter = "grayscale(1) brightness(0.4)";
                    wrap.style.pointerEvents = "none";
                } else {
                    wrap.onclick = () => playCard(i);
                    // 3D Tilt Event
                    add3DTiltEffect(wrap);
                }

                container.appendChild(wrap);
            });
        }

        // „Ç´„Éº„Éâ„ÅÆ„Ç≠„É©„Ç≠„É©ÔºÜÂÇæ„ÅçÂá¶ÁêÜ (Kira-Kira Logic)
        function add3DTiltEffect(el) {
            const frame = el.querySelector('.card-frame');
            const shine = el.querySelector('.card-shine');
            
            el.addEventListener('mousemove', (e) => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left; // Ë¶ÅÁ¥†ÂÜÖ„ÅÆXÂ∫ßÊ®ô
                const y = e.clientY - rect.top;  // Ë¶ÅÁ¥†ÂÜÖ„ÅÆYÂ∫ßÊ®ô
                
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                const rotateX = ((y - centerY) / centerY) * -15; // Á∏¶„ÅÆÂÇæ„Åç
                const rotateY = ((x - centerX) / centerX) * 15;  // Ê®™„ÅÆÂÇæ„Åç
                
                frame.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.1)`;
                
                // ÂÖâ„ÅÆÁßªÂãï
                shine.style.backgroundPosition = `${100 - (x / rect.width * 100)}% ${100 - (y / rect.height * 100)}%`;
                shine.style.opacity = "1";
            });
            
            el.addEventListener('mouseleave', () => {
                frame.style.transform = `rotateX(0) rotateY(0) scale(1)`;
                shine.style.opacity = "0";
            });
        }

        // --- 5. „Éê„Éà„É´„É≠„Ç∏„ÉÉ„ÇØ & ÂåñÂ≠¶ÂèçÂøú„Ç∑„Çπ„ÉÜ„É† ---
        function playCard(index) {
            const card = gameState.hand[index];
            gameState.mana -= card.cost;
            gameState.hand.splice(index, 1);
            
            // ÂäπÊûúÁô∫Âãï
            let power = card.val;
            let reactionMsg = "";
            let isCombo = false;

            // ‚òÖ CHEMICAL REACTION LOGIC ‚òÖ
            const field = gameState.fieldCard;
            
            if(field) {
                // 1. ÁàÜÁô∫ÂèçÂøú (H2 + O2)
                if((card.element==="H" && field.element==="O") || (card.element==="O" && field.element==="H")) {
                    power *= 2.5; reactionMsg = "EXPLOSION (2.5x)!"; isCombo=true;
                }
                // 2. ÂäáÁâ©ÁîüÊàê (Na + Cl -> NaCl È£üÂ°©„Å†„Åå„Åì„ÅÆ„Ç≤„Éº„É†„Åß„ÅØË°ùÊíÉÊ≥¢Êâ±„ÅÑ)
                else if((card.element==="Na" && field.element==="Cl") || (card.element==="Cl" && field.element==="Na")) {
                    power *= 2.0; reactionMsg = "IONIC BOND (2.0x)!"; isCombo=true;
                }
                // 3. ‰∏≠Âíå (Acid + Base)
                else if((card.element==="Acid" && field.element==="Base") || (card.element==="Base" && field.element==="Acid")) {
                    reactionMsg = "NEUTRALIZATION (HEAL)!"; isCombo=true;
                    gameState.playerHp = Math.min(gameState.playerMaxHp, gameState.playerHp + 50);
                    showFlyText("+50 HP", "#00ff9d", window.innerWidth/4, window.innerHeight/2);
                }
            }

            // „Ç≥„É≥„ÉúÊºîÂá∫
            if(isCombo) {
                const cmb = document.getElementById('combo-display');
                cmb.innerText = reactionMsg;
                cmb.classList.remove('combo-anim');
                void cmb.offsetWidth; // „É™„Éï„É≠„Éº
                cmb.classList.add('combo-anim');
            }

            // „É°„Ç§„É≥Âá¶ÁêÜ
            if(card.type === "ATK") {
                // „ÉÄ„É°„Éº„Ç∏Ë®àÁÆó
                applyDamageToEnemy(power);
            } else if(card.type === "HEAL") {
                gameState.playerHp = Math.min(gameState.playerMaxHp, gameState.playerHp + power);
                showFlyText(`+${power}`, "#00ff9d", window.innerWidth/4, window.innerHeight/2);
            } else if(card.type === "DEF") {
                gameState.playerHp += power/2; // Á∞°Êòì„Ç∑„Éº„É´„Éâ
                showFlyText(`SHIELD +${power/2}`, "#0066ff", window.innerWidth/4, window.innerHeight/2);
            }

            // Â†¥„Å´ÊÆã„Åô
            gameState.fieldCard = card;
            
            drawCard(); // 1ÊûöÂºï„Åè
            updateUI();
            
            if(gameState.enemyHp <= 0) {
                setTimeout(() => alert("ENEMY NEUTRALIZED! YOU WIN!"), 500);
            } else {
                // „Çø„Éº„É≥ÁµÇ‰∫ÜÂà§ÂÆöÔºà„Éû„Éä„Åå„Å™„ÅÑ„Å™„ÇâËá™Âãï„ÅßÊïµ„Çø„Éº„É≥„Å∏Ôºâ
                if(gameState.mana <= 0) setTimeout(enemyTurn, 1000);
            }
        }

        function applyDamageToEnemy(val) {
            val = Math.floor(val);
            gameState.enemyHp = Math.max(0, gameState.enemyHp - val);
            showFlyText(val, "var(--neon-pink)", window.innerWidth*0.75, window.innerHeight*0.3);
            
            const eUnit = document.getElementById('enemy-unit');
            eUnit.style.animation = "shake 0.4s";
            setTimeout(()=>eUnit.style.animation = "float 3s infinite ease-in-out", 400);
        }

        // --- 6. ÊïµAI (V2.0) ---
        function decideEnemyIntent() {
            // „É©„É≥„ÉÄ„É†„ÅßË°åÂãï„ÇíÂ§â„Åà„Çã
            const r = Math.random();
            const badge = document.getElementById('enemy-intent');
            
            if(r < 0.6) {
                gameState.enemyIntent = "attack";
                badge.innerText = "‚ö† ATTACK";
                badge.style.borderColor = "var(--neon-pink)";
            } else if(r < 0.8) {
                gameState.enemyIntent = "charge";
                badge.innerText = "‚ö° GATHERING ENERGY";
                badge.style.borderColor = "var(--neon-gold)";
            } else {
                gameState.enemyIntent = "defend";
                badge.innerText = "üõ° DEFENSE STANCE";
                badge.style.borderColor = "var(--neon-blue)";
            }
        }

        function enemyTurn() {
            showFlyText("ENEMY TURN", "#fff", window.innerWidth/2, window.innerHeight/2);
            
            setTimeout(() => {
                let dmg = 0;
                
                if(gameState.enemyIntent === "attack") {
                    dmg = 20 + Math.floor(Math.random()*20);
                    // „Éó„É¨„Ç§„É§„Éº„ÅåÂ∏å„Ç¨„Çπ(Noble)„Çí„Éï„Ç£„Éº„É´„Éâ„Å´Âá∫„Åó„Å¶„ÅÑ„Çã„Å®„ÉÄ„É°„Éº„Ç∏ÁÑ°ÂäπÂåñ„Å™„Å©„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„ÇÇÂèØ
                    if(gameState.fieldCard && gameState.fieldCard.element === "Noble") {
                        dmg = 0;
                        showFlyText("BLOCKED (NOBLE GAS)", "#00ff9d", window.innerWidth/4, window.innerHeight/2);
                    }
                } else if(gameState.enemyIntent === "charge") {
                    showFlyText("ENERGY SURGING...", "var(--neon-gold)", window.innerWidth*0.75, window.innerHeight*0.3);
                    // Ê¨°„ÅÆ„Çø„Éº„É≥Áóõ„Åè„Å™„ÇãÔºàÁ∞°ÊòìÂÆüË£Ö„Å®„Åó„Å¶ÂõûÂæ©„Åï„Åõ„ÇãÔºâ
                    gameState.enemyHp = Math.min(gameState.enemyMaxHp, gameState.enemyHp + 30);
                } else {
                    // Èò≤Âæ°
                    gameState.enemyHp += 50;
                    showFlyText("ARMOR UP", "var(--neon-blue)", window.innerWidth*0.75, window.innerHeight*0.3);
                }

                if(dmg > 0) {
                    gameState.playerHp = Math.max(0, gameState.playerHp - dmg);
                    showFlyText(`-${dmg}`, "var(--neon-pink)", window.innerWidth/4, window.innerHeight/2);
                    document.body.style.animation = "shake 0.2s";
                    setTimeout(()=>document.body.style.animation="", 200);
                }

                updateUI();
                gameState.fieldCard = null; // Â†¥„Çí„É™„Çª„ÉÉ„Éà

                if(gameState.playerHp <= 0) {
                    alert("CRITICAL SYSTEM FAILURE... DEFEAT");
                    location.reload();
                } else {
                    startTurn();
                }
            }, 1500);
        }

        // --- „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ---
        function showFlyText(text, color, x, y) {
            const el = document.createElement('div');
            el.className = 'fly-text';
            el.innerText = text;
            el.style.color = color;
            el.style.left = x + "px";
            el.style.top = y + "px";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // „Ç∑„Çß„Ç§„ÇØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ©
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes shake { 0%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} 100%{transform:translateX(0);} }
        `;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>