<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inorganic Battle Arena</title>
    <style>
        /* --- å…¨ä½“è¨­å®š --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e; /* æ¿ƒç´º */
            color: white;
            margin: 0; padding: 0;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ãªã„ */
            height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆç”¨ --- */
        .screen {
            display: none; /* åŸºæœ¬ã¯éš ã™ */
            width: 100%; height: 100%;
            flex-direction: column; align-items: center; justify-content: center;
            position: absolute; top: 0; left: 0;
        }
        .active { display: flex; } /* activeã‚¯ãƒ©ã‚¹ãŒã¤ã„ãŸç”»é¢ã ã‘è¡¨ç¤º */

        /* --- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ (Menu) --- */
        h1 { font-size: 3rem; text-shadow: 0 0 20px #e94560; margin-bottom: 40px; }
        .menu-btn {
            width: 280px; padding: 20px; margin: 10px;
            font-size: 1.2rem; font-weight: bold;
            color: #fff; background: rgba(255, 255, 255, 0.1);
            border: 2px solid #0f3460; border-radius: 10px;
            cursor: pointer; transition: 0.3s;
        }
        .menu-btn:hover { background: #e94560; border-color: #e94560; transform: scale(1.05); }
        .disabled { opacity: 0.5; cursor: not-allowed; } /* æº–å‚™ä¸­ãƒœã‚¿ãƒ³ç”¨ */

        /* --- ãƒãƒˆãƒ«ç”»é¢ (Game) --- */
        .battle-container {
            width: 90%; max-width: 800px; height: 90%;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* HPãƒãƒ¼ã‚¨ãƒªã‚¢ */
        .status-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; background: rgba(0,0,0,0.5); border-radius: 10px;
        }
        .player-info { width: 45%; }
        .hp-bar-frame {
            width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin-top: 5px;
        }
        .hp-bar-fill {
            height: 100%; background: linear-gradient(90deg, #f1c40f, #2ecc71);
            width: 100%; transition: width 0.5s ease-out;
        }
        .turn-indicator { font-size: 1.5rem; font-weight: bold; color: #f39c12; }

        /* å®Ÿé¨“ã‚¨ãƒªã‚¢ */
        .arena {
            flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
        }
        .reaction-zone {
            width: 200px; height: 200px;
            border: 4px dashed #555; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: #aaa;
            background: rgba(255,255,255,0.05);
        }

        /* æ‰‹æœ­ã‚¨ãƒªã‚¢ */
        .hand-area {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;
        }
        .card-row { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        
        .card {
            width: 60px; height: 90px;
            background: white; color: #333; border-radius: 6px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 1rem; font-weight: bold; cursor: pointer; border: 2px solid #999;
            user-select: none;
        }
        .card.cation { border-color: #e74c3c; background: #fadbd8; }
        .card.anion { border-color: #3498db; background: #d6eaf8; }
        .card.selected { transform: translateY(-10px); box-shadow: 0 0 15px gold; border-color: gold; }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        #attack-btn {
            margin-top: 10px; padding: 10px 40px; font-size: 1.2rem;
            background: #e94560; color: white; border: none; border-radius: 30px;
            cursor: pointer;
        }
        #attack-btn:disabled { background: #555; cursor: not-allowed; }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡º */
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -2px); } }
        .shake { animation: shake 0.5s; animation-iteration-count: infinite; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆçµæœè¡¨ç¤ºï¼‰ */
        .modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; color: black; padding: 20px; border-radius: 10px;
            text-align: center; display: none; z-index: 100; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            width: 80%; max-width: 400px;
        }
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; z-index: 90;
        }

    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <h1>âš—ï¸ INORGANIC BATTLE</h1>
        <button class="menu-btn" onclick="startGame('local')">âš”ï¸ ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ (2P)</button>
        <button class="menu-btn" onclick="startGame('cpu')">ğŸ¤– CPU å¯¾æˆ¦ (Practice)</button>
        <button class="menu-btn disabled" onclick="alert('é–‹ç™ºä¸­ã§ã™ï¼GitHubã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å¾…ã¦ï¼')">ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ (Coming Soon)</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="battle-container">
            
            <div class="status-bar">
                <div class="player-info">
                    <div>PLAYER 1</div>
                    <div class="hp-bar-frame"><div id="p1-hp" class="hp-bar-fill"></div></div>
                </div>
                <div class="turn-indicator" id="turn-text">P1 TURN</div>
                <div class="player-info" style="text-align: right;">
                    <div>PLAYER 2 (CPU)</div>
                    <div class="hp-bar-frame"><div id="p2-hp" class="hp-bar-fill" style="margin-left: auto;"></div></div>
                </div>
            </div>

            <div class="arena">
                <div class="reaction-zone" id="reaction-display">
                    SELECT CARDS
                </div>
                <button id="attack-btn" onclick="executeTurn()">ATTACK / REACT</button>
            </div>

            <div class="hand-area">
                <div class="card-row" id="hand-container">
                    </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="modal" id="result-modal">
        <h2 id="modal-title">TITLE</h2>
        <p id="modal-desc">Description</p>
        <button class="menu-btn" style="background:#333; width:100%;" onclick="closeModal()">OK</button>
    </div>

<script>
    // --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ ---
    const cards = [
        { id: "Ag+", type: "cation", label: "Ag<sup>+</sup>" },
        { id: "Cu2+", type: "cation", label: "Cu<sup>2+</sup>" },
        { id: "Fe3+", type: "cation", label: "Fe<sup>3+</sup>" },
        { id: "Ba2+", type: "cation", label: "Ba<sup>2+</sup>" },
        { id: "Cl-", type: "anion", label: "Cl<sup>-</sup>" },
        { id: "S2-", type: "anion", label: "S<sup>2-</sup>" },
        { id: "OH-", type: "anion", label: "OH<sup>-</sup>" },
        { id: "SO4 2-", type: "anion", label: "SO<sub>4</sub><sup>2-</sup>" }
    ];

    const reactions = {
        "Ag+,Cl-": { power: 20, name: "AgCl (ç™½)", desc: "ç™½è‰²æ²ˆæ®¿ã‚¢ã‚¿ãƒƒã‚¯ï¼" },
        "Ag+,S2-": { power: 30, name: "Ag2S (é»’)", desc: "é»’è‰²æ²ˆæ®¿ã€‚å¼·åŠ›ãªãƒ€ãƒ¡ãƒ¼ã‚¸ï¼" },
        "Cu2+,S2-": { power: 30, name: "CuS (é»’)", desc: "çœŸã£é»’ãªæ²ˆæ®¿ã§è¦–ç•Œã‚’å¥ªã†ï¼" },
        "Cu2+,OH-": { power: 25, name: "Cu(OH)2 (é’ç™½)", desc: "ç¾ã—ã„é’ç™½è‰²ã®åŠ‡è–¬ï¼" },
        "Fe3+,OH-": { power: 25, name: "Fe(OH)3 (èµ¤è¤)", desc: "èµ¤ã‚µãƒ“æ”»æ’ƒï¼" },
        "Ba2+,SO4 2-": { power: 40, name: "BaSO4 (ç™½)", desc: "Xç·šã‚‚é€šã•ãªã„çµ¶å¯¾é˜²å¾¡å£ï¼å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼" }
    };

    // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç† ---
    let gameState = {
        mode: null, // 'local' or 'cpu'
        turn: 1, // 1 or 2
        hp: { 1: 100, 2: 100 },
        selected: { cation: null, anion: null }
    };

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹
    function startGame(mode) {
        gameState.mode = mode;
        gameState.hp = { 1: 100, 2: 100 };
        gameState.turn = 1;
        updateUI();
        renderHand();
        showScreen('screen-game');
    }

    // æ‰‹æœ­æç”»
    function renderHand() {
        const container = document.getElementById('hand-container');
        container.innerHTML = '';
        cards.forEach(card => {
            const el = document.createElement('div');
            el.className = `card ${card.type}`;
            el.innerHTML = card.label;
            el.onclick = () => selectCard(card, el);
            container.appendChild(el);
        });
    }

    // ã‚«ãƒ¼ãƒ‰é¸æŠ
    function selectCard(card, el) {
        // åŒã˜ã‚¿ã‚¤ãƒ—ã®é¸æŠã‚’è§£é™¤
        const currentSelected = gameState.selected[card.type];
        if (currentSelected) {
            // ä»¥å‰ã®DOMé¸æŠè§£é™¤å‡¦ç†ãŒå¿…è¦ã ãŒç°¡ç•¥åŒ–ã®ãŸã‚å†æç”»ã§ã‚‚å¯ã€‚
            // ä»Šå›ã¯DOMãƒªã‚¹ãƒˆã‹ã‚‰æ¢ã—ã¦classã‚’æ¶ˆã™
            document.querySelectorAll(`.card.${card.type}`).forEach(c => c.classList.remove('selected'));
        }

        el.classList.add('selected');
        gameState.selected[card.type] = card.id;

        // ä¸­å¤®è¡¨ç¤ºæ›´æ–°
        const c = gameState.selected.cation || "?";
        const a = gameState.selected.anion || "?";
        document.getElementById('reaction-display').innerHTML = `${c} + ${a}`;
    }

    // ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œï¼ˆæ”»æ’ƒï¼‰
    function executeTurn() {
        const { cation, anion } = gameState.selected;
        if (!cation || !anion) {
            alert("é™½ã‚¤ã‚ªãƒ³ã¨é™°ã‚¤ã‚ªãƒ³ã‚’1ã¤ãšã¤é¸ã‚“ã§ãã ã•ã„");
            return;
        }

        const key = `${cation},${anion}`;
        const reaction = reactions[key];
        const opponent = gameState.turn === 1 ? 2 : 1;

        if (reaction) {
            // æˆåŠŸï¼šãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
            applyDamage(opponent, reaction.power);
            showResult(`HIT! -${reaction.power}`, `${reaction.name}<br>${reaction.desc}`);
        } else {
            // å¤±æ•—ï¼šè‡ªçˆ†ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆã‚²ãƒ¼ãƒ æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ï¼‰
            applyDamage(gameState.turn, 10);
            showResult("MISS...", "åå¿œãªã—ï¼å®Ÿé¨“å¤±æ•—ã§10ãƒ€ãƒ¡ãƒ¼ã‚¸å—ã‘ãŸ...");
        }
    }

    // ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†
    function applyDamage(targetPlayer, damage) {
        gameState.hp[targetPlayer] -= damage;
        if (gameState.hp[targetPlayer] < 0) gameState.hp[targetPlayer] = 0;
        updateUI();

        if (gameState.hp[targetPlayer] <= 0) {
            setTimeout(() => {
                alert(`PLAYER ${gameState.turn} WIN!`);
                showScreen('screen-menu'); // ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹
            }, 1000);
        } else {
            // ã‚¿ãƒ¼ãƒ³äº¤ä»£
            gameState.turn = gameState.turn === 1 ? 2 : 1;
            gameState.selected = { cation: null, anion: null };
            renderHand(); // é¸æŠè§£é™¤ã®ãŸã‚å†æç”»
            updateUI();
            
            // CPUãƒ¢ãƒ¼ãƒ‰ãªã‚‰è‡ªå‹•åæ’ƒ
            if (gameState.mode === 'cpu' && gameState.turn === 2) {
                setTimeout(cpuTurn, 1000);
            }
        }
    }

    // ç°¡å˜ãªCPUãƒ­ã‚¸ãƒƒã‚¯
    function cpuTurn() {
        // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶ï¼ˆãŸã¾ã«æˆåŠŸã™ã‚‹ï¼‰
        const c = cards.filter(c => c.type === 'cation')[Math.floor(Math.random() * 4)];
        const a = cards.filter(c => c.type === 'anion')[Math.floor(Math.random() * 4)];
        
        // æ“¬ä¼¼çš„ã«é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
        gameState.selected.cation = c.id;
        gameState.selected.anion = a.id;
        document.getElementById('reaction-display').innerHTML = `CPU is choosing...`;

        setTimeout(executeTurn, 1000);
    }

    // UIæ›´æ–°
    function updateUI() {
        document.getElementById('p1-hp').style.width = gameState.hp[1] + "%";
        document.getElementById('p2-hp').style.width = gameState.hp[2] + "%";
        document.getElementById('turn-text').innerText = gameState.mode === 'cpu' && gameState.turn === 2 ? "CPU TURN" : `PLAYER ${gameState.turn} TURN`;
        document.getElementById('reaction-display').innerText = "SELECT CARDS";
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    function showResult(title, desc) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-desc').innerHTML = desc;
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('result-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('result-modal').style.display = 'none';
    }

</script>
</body>
</html>