<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEMISTRY BATTLE 3D</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;700&family=M+PLUS+1p:wght@800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00eaff;
            --accent: #ff0055;
            --bg-deep: #0a0b1e;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-deep);
            /* å¥¥è¡Œãã®ã‚ã‚‹ã‚°ãƒªãƒƒãƒ‰åºŠ */
            background-image: 
                linear-gradient(rgba(0, 234, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 234, 255, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            font-family: 'M PLUS 1p', sans-serif;
            color: white;
            height: 100dvh; width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
            /* â˜…CSSé­”æ³•1ï¼šç”»é¢å…¨ä½“ã‚’3Dç©ºé–“ã«ã™ã‚‹ */
            perspective: 1000px;
        }

        /* --- ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            transition: opacity 0.5s; opacity: 0; pointer-events: none;
        }
        .screen.active { opacity: 1; pointer-events: auto; }

        /* --- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ --- */
        #screen-title {
            justify-content: center; align-items: center;
            background: radial-gradient(circle, rgba(0,234,255,0.1) 0%, var(--bg-deep) 70%);
        }
        .title-text {
            font-family: 'Teko', sans-serif; font-size: 5rem; line-height: 0.8;
            text-align: center; text-shadow: 0 0 20px var(--primary);
            transform: rotateX(20deg); /* ã‚¿ã‚¤ãƒˆãƒ«ã‚‚å°‘ã—å€’ã™ */
        }
        .start-btn {
            margin-top: 50px; padding: 15px 60px; font-size: 1.5rem; font-weight: bold;
            color: var(--primary); background: transparent; border: 2px solid var(--primary);
            border-radius: 50px; cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 15px var(--primary); text-transform: uppercase;
        }
        .start-btn:hover { background: var(--primary); color: #000; transform: scale(1.1); }

        /* --- ãƒãƒˆãƒ«ç”»é¢ (3Dã‚¹ãƒ†ãƒ¼ã‚¸) --- */
        #battle-stage {
            flex: 1; display: flex; flex-direction: column;
            /* â˜…CSSé­”æ³•2ï¼šç›¤é¢ã‚’å¥¥ã«å€’ã—ã¦ç«‹ä½“æ„Ÿã‚’å‡ºã™ */
            transform: rotateX(20deg) translateY(-20px);
            transform-style: preserve-3d;
        }

        /* æ•µã‚¨ãƒªã‚¢ */
        .area-enemy {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 20px;
        }
        .boss-card {
            width: 140px; height: 190px;
            background: linear-gradient(135deg, #330000, #000);
            border: 3px solid var(--accent); border-radius: 12px;
            box-shadow: 0 0 40px rgba(255, 0, 85, 0.4);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            /* æ•µã¯æµ®ã„ã¦ã„ã‚‹æ¼”å‡º */
            animation: floatEnemy 3s infinite ease-in-out;
        }
        @keyframes floatEnemy { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }
        
        .boss-hp-bar {
            width: 160px; height: 12px; background: #333; border-radius: 6px; margin-top: 15px;
            border: 1px solid #666; overflow: hidden;
        }
        .boss-hp-fill { width: 100%; height: 100%; background: var(--accent); transition: width 0.3s; }

        /* ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™å ´æ‰€) */
        .area-field {
            flex: 1; display: flex; justify-content: center; align-items: center; position: relative;
        }
        .drop-zone {
            width: 120px; height: 170px; border: 2px dashed rgba(0, 234, 255, 0.3); border-radius: 12px;
            display: flex; justify-content: center; align-items: center; color: rgba(0, 234, 255, 0.5);
            font-weight: bold; letter-spacing: 2px;
            /* åœ°é¢ã«å¼µã‚Šä»˜ã„ã¦ã„ã‚‹ã‚ˆã†ã«å¤‰å½¢ */
            transform: rotateX(40deg);
            transition: 0.3s;
        }
        /* â˜…CSSé­”æ³•3ï¼šãƒ‰ãƒ©ãƒƒã‚°ã™ã¹ãå ´æ‰€ã‚’å…‰ã‚‰ã›ã‚‹ */
        .drop-zone.highlight {
            border-color: var(--primary); background: rgba(0, 234, 255, 0.1);
            box-shadow: 0 0 30px var(--primary); transform: rotateX(40deg) scale(1.1);
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ‰‹æœ­ */
        .area-hand {
            height: 220px; display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 20px; z-index: 50; perspective: 1000px;
        }

        /* --- 3Dã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        .card {
            width: 110px; height: 160px;
            background: #fff; border-radius: 10px;
            border: 4px solid #ccc;
            position: relative; margin: 0 -10px; /* ã‚«ãƒ¼ãƒ‰ã‚’é‡ã­ã‚‹ */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center bottom;
            cursor: pointer; box-shadow: -5px 5px 15px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; overflow: hidden;
        }
        
        /* å±æ€§ã”ã¨ã®è‰² */
        .type-fire { border-color: #ff4757; background: linear-gradient(135deg, #fff, #ffcccc); }
        .type-water { border-color: #1e90ff; background: linear-gradient(135deg, #fff, #ccf0ff); }
        .type-thunder { border-color: #ffd700; background: linear-gradient(135deg, #fff, #ffffcc); }

        /* â˜…CSSé­”æ³•4ï¼šãƒ›ãƒãƒ¼æ™‚ã«ã‚«ãƒ¼ãƒ‰ãŒæ‰‹å‰ã«é£›ã³å‡ºã™ */
        .card:hover {
            transform: translateY(-60px) scale(1.3) rotateX(0deg) !important;
            z-index: 100; margin: 0 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        .card.disabled { filter: grayscale(1); opacity: 0.6; pointer-events: none; }

        /* ã‚«ãƒ¼ãƒ‰ã®ä¸­èº« */
        .c-header { display: flex; justify-content: space-between; padding: 3px 5px; font-weight: bold; font-size: 0.7rem; color: #333; }
        .c-img { flex: 1; background: #333; margin: 0 5px; display: flex; justify-content: center; align-items: center; font-size: 2rem; border-radius: 4px; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .c-body { padding: 5px; }
        .c-move { display: flex; justify-content: space-between; font-weight: bold; font-size: 0.8rem; border-bottom: 1px solid rgba(0,0,0,0.1); margin-bottom: 2px; }
        .c-cost { display: flex; gap: 2px; }
        .orb { width: 10px; height: 10px; border-radius: 50%; background: #333; }
        .orb.on { background: var(--primary); box-shadow: 0 0 5px var(--primary); }

        /* ã‚¬ã‚¤ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .guide-msg {
            position: fixed; top: 15%; width: 100%; text-align: center;
            font-size: 1.5rem; font-weight: bold; color: var(--primary);
            text-shadow: 0 0 10px var(--primary); pointer-events: none; z-index: 1000;
            animation: pulseText 1s infinite alternate;
        }
        @keyframes pulseText { from{opacity:0.7;} to{opacity:1; transform:scale(1.05);} }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .fire-btn {
            position: absolute; bottom: 100px; z-index: 200;
            background: var(--accent); color: white; border: 3px solid white;
            padding: 15px 50px; border-radius: 50px; font-size: 1.5rem; font-weight: 900;
            font-family: 'Teko', sans-serif; letter-spacing: 2px;
            box-shadow: 0 0 30px var(--accent); cursor: pointer;
            display: none; animation: popBtn 0.3s;
        }
        @keyframes popBtn { from{transform:scale(0);} to{transform:scale(1);} }

        /* HUD */
        .hud {
            position: fixed; top: 0; left: 0; width: 100%; padding: 15px;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .mana-box {
            background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px;
            border: 1px solid var(--primary); color: var(--primary); font-weight: bold;
            display: flex; gap: 5px;
        }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸æ•°å­— */
        .dmg-pop {
            position: absolute; font-size: 4rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 15px var(--accent); pointer-events: none; z-index: 2000;
            animation: dmgAnim 0.8s forwards;
        }
        @keyframes dmgAnim { 0%{transform:translate(-50%,0) scale(0);} 20%{transform:translate(-50%,-50px) scale(1.5);} 100%{transform:translate(-50%,-100px) scale(1); opacity:0;} }

    </style>
</head>
<body>

    <div id="screen-title" class="screen active">
        <div class="title-text">CHEMISTRY<br>BATTLE</div>
        <p style="color:#aaa; letter-spacing: 5px;">3D TACTICAL CARD GAME</p>
        <button class="start-btn" onclick="startGame()">BATTLE START</button>
    </div>

    <div id="screen-battle" class="screen">
        
        <div id="guide" class="guide-msg">ã‚¯ã‚¤ã‚ºã«ç­”ãˆã¦ã‚¨ãƒŠã‚¸ãƒ¼å……å¡«ï¼</div>

        <div class="hud">
            <div style="font-weight:bold;">PLAYER HP: <span id="hp-val">100</span></div>
            <div class="mana-box">
                âš¡ <span id="mana-val">0</span> / 5
            </div>
        </div>

        <div id="battle-stage" class="battle-stage">
            <div class="area-enemy">
                <div class="boss-card" id="enemy-card">
                    <div style="font-size:3rem; margin-top:20px;">ğŸ‘¹</div>
                    <div style="color:var(--accent); font-weight:bold; margin-top:10px;">æ¿ƒç¡«é…¸</div>
                    <div style="color:#aaa; font-size:0.8rem;">HP: High</div>
                </div>
                <div class="boss-hp-bar"><div id="enemy-hp" class="boss-hp-fill"></div></div>
            </div>

            <div class="area-field">
                <div id="drop-zone" class="drop-zone">CARD HERE</div>
                <button id="fire-btn" class="fire-btn" onclick="attack()">FIRE!</button>
            </div>

            <div class="area-hand" id="hand">
                </div>
        </div>
    </div>

    <div id="quiz-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; display:none; flex-direction:column; justify-content:center; align-items:center;">
        <h2 style="color:var(--primary);">ENERGY CHARGE</h2>
        <p id="q-text" style="font-size:1.5rem; margin:20px; font-weight:bold; text-align:center;">...</p>
        <div id="q-opts" style="display:flex; flex-direction:column; gap:15px; width:80%; max-width:400px;"></div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿
        const cards = [
            {name:"æ°´ç´ ", type:"fire", val:30, cost:1, img:"Hâ‚‚"},
            {name:"é»’é‰›", type:"thunder", val:20, cost:1, img:"C"},
            {name:"å¡©é…¸", type:"water", val:50, cost:2, img:"HCl"},
            {name:"ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢", type:"water", val:40, cost:2, img:"NHâ‚ƒ"},
            {name:"ç‹æ°´", type:"fire", val:80, cost:3, img:"Au"}
        ];
        const quizzes = [
            {q:"åŸå­ç•ªå·1ç•ªã¯ï¼Ÿ", a:0, o:["æ°´ç´ ","ãƒ˜ãƒªã‚¦ãƒ ","ãƒªãƒã‚¦ãƒ "]},
            {q:"ç‚è‰²åå¿œï¼šèµ¤è‰²ã¯ï¼Ÿ", a:0, o:["ãƒªãƒã‚¦ãƒ ","ãƒŠãƒˆãƒªã‚¦ãƒ ","éŠ…"]},
            {q:"è…åµè‡­ãŒã™ã‚‹ã®ã¯ï¼Ÿ", a:1, o:["é…¸ç´ ","ç¡«åŒ–æ°´ç´ ","å¡©ç´ "]}
        ];

        // å¤‰æ•°
        let mana = 0;
        let enemyHp = 100;
        let selectedCard = null;

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('screen-title').classList.remove('active');
            document.getElementById('screen-battle').classList.add('active');
            
            // ã‚¯ã‚¤ã‚ºé–‹å§‹
            setTimeout(startQuiz, 1000);
        }

        // ã‚¯ã‚¤ã‚ºå‡¦ç†
        function startQuiz() {
            const q = quizzes[Math.floor(Math.random() * quizzes.length)];
            document.getElementById('q-text').innerText = q.q;
            const div = document.getElementById('q-opts');
            div.innerHTML = "";
            
            q.o.forEach((txt, i) => {
                const btn = document.createElement('button');
                btn.innerText = txt;
                btn.style.padding = "15px";
                btn.style.fontSize = "1.2rem";
                btn.style.fontWeight = "bold";
                btn.style.background = "#fff";
                btn.style.border = "none";
                btn.style.borderRadius = "10px";
                btn.onclick = () => {
                    document.getElementById('quiz-overlay').style.display = 'none';
                    if(i === q.a) {
                        mana = Math.min(5, mana + 2);
                        showGuide("ãƒãƒ£ãƒ¼ã‚¸å®Œäº†ï¼ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¹ï¼");
                    } else {
                        mana = Math.min(5, mana + 1);
                        showGuide("ä¸€éƒ¨ãƒãƒ£ãƒ¼ã‚¸... ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¹ï¼");
                    }
                    updateUI();
                    renderHand();
                };
                div.appendChild(btn);
            });
            document.getElementById('quiz-overlay').style.display = 'flex';
        }

        // UIæ›´æ–°
        function updateUI() {
            document.getElementById('mana-val').innerText = mana;
            document.getElementById('enemy-hp').style.width = enemyHp + "%";
        }

        // æ‰‹æœ­æç”»
        function renderHand() {
            const hand = document.getElementById('hand');
            hand.innerHTML = "";
            cards.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = `card type-${c.type}`;
                if(c.cost > mana) div.classList.add('disabled');
                
                // æ‰‡çŠ¶ã«é…ç½®ã™ã‚‹è¨ˆç®— (rotate)
                const rotate = (i - 2) * 5; 
                const y = Math.abs(i - 2) * 10;
                div.style.transform = `rotate(${rotate}deg) translateY(${y}px)`;

                // ã‚³ã‚¹ãƒˆç‰ã®ç”Ÿæˆ
                let orbs = "";
                for(let j=0; j<c.cost; j++) orbs += `<div class="orb on"></div>`;

                div.innerHTML = `
                    <div class="c-header"><span>${c.name}</span><span>HP 60</span></div>
                    <div class="c-img">${c.img}</div>
                    <div class="c-body">
                        <div class="c-move">
                            <div class="c-cost">${orbs}</div>
                            <div>æ”»æ’ƒ</div>
                            <div>${c.val}</div>
                        </div>
                    </div>
                `;
                div.onclick = () => selectCard(c, div);
                hand.appendChild(div);
            });
        }

        // ã‚«ãƒ¼ãƒ‰é¸æŠ
        function selectCard(c, el) {
            if(c.cost > mana) return;
            
            // å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹è§£é™¤
            document.querySelectorAll('.card').forEach(card => card.style.opacity = "0.5");
            el.style.opacity = "1";
            el.style.transform = "translateY(-80px) scale(1.2)"; // é¸æŠæ™‚ã¯é£›ã³å‡ºã™
            
            selectedCard = c;
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚’å…‰ã‚‰ã›ã‚‹
            const zone = document.getElementById('drop-zone');
            zone.classList.add('highlight');
            zone.innerText = "ã‚»ãƒƒãƒˆå®Œäº†";
            
            document.getElementById('fire-btn').style.display = 'block';
            showGuide("ã€ŒFIRE!ã€ãƒœã‚¿ãƒ³ã§æ”»æ’ƒï¼");
        }

        // æ”»æ’ƒå®Ÿè¡Œ
        function attack() {
            if(!selectedCard) return;
            
            mana -= selectedCard.cost;
            document.getElementById('fire-btn').style.display = 'none';
            document.getElementById('drop-zone').classList.remove('highlight');
            document.getElementById('drop-zone').innerText = "æ”»æ’ƒä¸­...";
            
            // ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†
            const dmg = selectedCard.val;
            enemyHp = Math.max(0, enemyHp - dmg);
            updateUI();
            
            // æ¼”å‡º
            showDamage(dmg);
            document.getElementById('enemy-card').style.transform = "translateY(-15px) rotate(5deg)";
            setTimeout(() => document.getElementById('enemy-card').style.transform = "none", 200);

            if(enemyHp <= 0) {
                showGuide("VICTORY!!");
                setTimeout(() => location.reload(), 2000);
            } else {
                setTimeout(() => {
                    showGuide("æ•µã®ã‚¿ãƒ¼ãƒ³...");
                    setTimeout(startQuiz, 1500);
                }, 1000);
            }
        }

        function showDamage(val) {
            const el = document.createElement('div');
            el.className = 'dmg-pop';
            el.innerText = val;
            el.style.left = "50%"; el.style.top = "30%";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function showGuide(text) {
            document.getElementById('guide').innerText = text;
        }

    </script>
</body>
</html>